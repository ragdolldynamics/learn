
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,noarchive,nofollow" />

    
      
        <title>Parallel - Learn Ragdoll</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="white">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://learn.ragdolldynamics.com" title="Learn Ragdoll" class="md-header-nav__button md-logo" aria-label="Learn Ragdoll">
      
  <img src="../ragdoll_silhouette_black_512.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Learn Ragdoll
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Parallel
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/mottosso/ragdoll/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mottosso/ragdoll
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://learn.ragdolldynamics.com" title="Learn Ragdoll" class="md-nav__button md-logo" aria-label="Learn Ragdoll">
      
  <img src="../ragdoll_silhouette_black_512.png" alt="logo">

    </a>
    Learn Ragdoll
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/mottosso/ragdoll/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mottosso/ragdoll
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        

        Home
      </a>
    </li>
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        

        Overview
      </a>
    </li>
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  

    <!-- Determine whether to render item as a section -->
    

    <!-- Render item with nested items -->
    <li class="md-nav__item md-nav__item--nested">

      <!-- Active checkbox expands items contained within nested section -->
      
      
        <input
          class="md-nav__toggle md-toggle"
          data-md-toggle="nav-3"
          type="checkbox"
          id="nav-3"
          
        />
      

      <!-- Expand active pages -->
      <label class="md-nav__link" for="nav-3">
        Documentation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav
        class="md-nav"
        aria-label="Documentation"
        data-md-level="1"
      >
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>

          <!-- Render nested item list -->
          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/marker/" class="md-nav__link">
        
        <img src="/icons/marker_black.png">
        

        Marker
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/group/" class="md-nav__link">
        
        <img src="/icons/ragdoll_black.png">
        

        Group
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/solver/" class="md-nav__link">
        
        <img src="/icons/solver_black.png">
        

        Solver
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/manipulator/" class="md-nav__link">
        
        <img src="/icons/manipulator_black.png">
        

        Manipulator
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/constraints/" class="md-nav__link">
        
        <img src="/icons/constraint_black.png">
        

        Constraints
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/fields/" class="md-nav__link">
        
        <img src="/icons/force_black.png">
        

        Fields
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/import_physics/" class="md-nav__link">
        
        <img src="/icons/save_black.png">
        

        Import Physics
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/record_simulation/" class="md-nav__link">
        
        <img src="/icons/record_black.png">
        

        Record Simulation
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/snap_to_simulation/" class="md-nav__link">
        
        <img src="/icons/snap_black.png">
        

        Snap to Simulation
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/retargeting/" class="md-nav__link">
        
        <img src="/icons/retarget_black.png">
        

        Retargeting
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/level_of_detail/" class="md-nav__link">
        
        <img src="/icons/hair2_black.png">
        

        Level Of Detail
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/cache/" class="md-nav__link">
        
        <img src="/icons/bake_black.png">
        

        Cache
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/link/" class="md-nav__link">
        
        <img src="/icons/link_black.png">
        

        Link
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../documentation/utilities/" class="md-nav__link">
        
        <img src="/icons/replace_black.png">
        

        Utilities
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>

  <!-- Currently active page -->
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  

    <!-- Determine whether to render item as a section -->
    

    <!-- Render item with nested items -->
    <li class="md-nav__item md-nav__item--nested">

      <!-- Active checkbox expands items contained within nested section -->
      
      
        <input
          class="md-nav__toggle md-toggle"
          data-md-toggle="nav-4"
          type="checkbox"
          id="nav-4"
          
        />
      

      <!-- Expand active pages -->
      <label class="md-nav__link" for="nav-4">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav
        class="md-nav"
        aria-label="Tutorials"
        data-md-level="1"
      >
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>

          <!-- Render nested item list -->
          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/videos/" class="md-nav__link">
        
        <img src="/icons/camera_black.png">
        

        Videos
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/manikin/" class="md-nav__link">
        
        <img src="/icons/ragdoll_black.png">
        

        Manikin
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/manikin_ragdoll/" class="md-nav__link">
        
        <img src="/icons/ragdoll_black.png">
        

        Full Ragdoll
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/manikin_ik/" class="md-nav__link">
        
        <img src="/icons/chain_black.png">
        

        Inverse Kinematics
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/mocap_chap/" class="md-nav__link">
        
        <img src="/icons/mocap_black.png">
        

        Mocap Chap
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/rookie_wasp/" class="md-nav__link">
        
        <img src="/icons/wasp_black.png">
        

        Rookie Wasp
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/self_walking/" class="md-nav__link">
        
        <img src="/icons/control_black.png">
        

        Self Walking
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../tutorials/bouncing_ball/" class="md-nav__link">
        
        <img src="/icons/physics_black.png">
        

        Bouncing Ball
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>

  <!-- Currently active page -->
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../download/" class="md-nav__link">
        

        Download
      </a>
    </li>
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../menu/" class="md-nav__link">
        

        Menu Reference
      </a>
    </li>
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        

        API Reference
      </a>
    </li>
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../licencing/" class="md-nav__link">
        

        Licencing
      </a>
    </li>
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../serialisation/" class="md-nav__link">
        

        Serialisation
      </a>
    </li>
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  

    <!-- Determine whether to render item as a section -->
    

    <!-- Render item with nested items -->
    <li class="md-nav__item md-nav__item--nested">

      <!-- Active checkbox expands items contained within nested section -->
      
      
        <input
          class="md-nav__toggle md-toggle"
          data-md-toggle="nav-10"
          type="checkbox"
          id="nav-10"
          
        />
      

      <!-- Expand active pages -->
      <label class="md-nav__link" for="nav-10">
        News
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav
        class="md-nav"
        aria-label="News"
        data-md-level="1"
      >
        <label class="md-nav__title" for="nav-10">
          <span class="md-nav__icon md-icon"></span>
          News
        </label>
        <ul class="md-nav__list" data-md-scrollfix>

          <!-- Render nested item list -->
          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.06.09/" class="md-nav__link">
        

        2022.06.09
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.05.04/" class="md-nav__link">
        

        2022.05.04
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.03.14/" class="md-nav__link">
        

        2022.03.14
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.02.28/" class="md-nav__link">
        

        2022.02.28
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.02.14/" class="md-nav__link">
        

        2022.02.14
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.02.01/" class="md-nav__link">
        

        2022.02.01
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.01.21/" class="md-nav__link">
        

        2022.01.21
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2022.01.17/" class="md-nav__link">
        

        2022.01.17
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.12.15/" class="md-nav__link">
        

        2021.12.15
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.12.12/" class="md-nav__link">
        

        2021.12.12
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.11.15/" class="md-nav__link">
        

        2021.11.15
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.10.25/" class="md-nav__link">
        

        2021.10.25
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.10.07/" class="md-nav__link">
        

        2021.10.07
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.09.27/" class="md-nav__link">
        

        2021.09.27
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.08.28/" class="md-nav__link">
        

        2021.08.28
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.08.06/" class="md-nav__link">
        

        2021.08.06
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.07.27/" class="md-nav__link">
        

        2021.07.27
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.07.15/" class="md-nav__link">
        

        2021.07.15
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.07.02/" class="md-nav__link">
        

        2021.07.02
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.06.10/" class="md-nav__link">
        

        2021.06.10
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.06.07/" class="md-nav__link">
        

        2021.06.07
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.05.17/" class="md-nav__link">
        

        2021.05.17
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.05.10/" class="md-nav__link">
        

        2021.05.10
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.04.28/" class="md-nav__link">
        

        2021.04.28
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.04.23/" class="md-nav__link">
        

        2021.04.23
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.04.11/" class="md-nav__link">
        

        2021.04.11
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.03.25/" class="md-nav__link">
        

        2021.03.25
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.03.23/" class="md-nav__link">
        

        2021.03.23
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.03.11/" class="md-nav__link">
        

        2021.03.11
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.03.04/" class="md-nav__link">
        

        2021.03.04
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.03.01/" class="md-nav__link">
        

        2021.03.01
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.02.07/" class="md-nav__link">
        

        2021.02.07
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.01.27/" class="md-nav__link">
        

        2021.01.27
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.01.17/" class="md-nav__link">
        

        2021.01.17
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.01.15/" class="md-nav__link">
        

        2021.01.15
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.01.14/" class="md-nav__link">
        

        2021.01.14
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2021.01.04/" class="md-nav__link">
        

        2021.01.04
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.12.18/" class="md-nav__link">
        

        2020.12.18
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.12.07/" class="md-nav__link">
        

        2020.12.07
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.12.01/" class="md-nav__link">
        

        2020.12.01
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.11.24/" class="md-nav__link">
        

        2020.11.24
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.11.23/" class="md-nav__link">
        

        2020.11.23
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.11.22/" class="md-nav__link">
        

        2020.11.22
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.11.17/" class="md-nav__link">
        

        2020.11.17
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.11.16/" class="md-nav__link">
        

        2020.11.16
      </a>
    </li>
  

          
            

  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../releases/2020.11.10/" class="md-nav__link">
        

        2020.11.10
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>

  <!-- Currently active page -->
  

    
      
      
      <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Wrap everything with a macro to reduce file roundtrips (see #2213) -->


<!-- Render current and nested navigation items -->


  <!-- Determine class according to state -->
  
  

  <!-- Main navigation item with nested items -->
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        

        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    Key Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-evaluation-modes" class="md-nav__link">
    Supported Evaluation Modes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-make-it-right-then-make-it-fast" class="md-nav__link">
    First Make it Right Then Make it Fast
  </a>
  
    <nav class="md-nav" aria-label="First Make it Right Then Make it Fast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluation-graph-correctness" class="md-nav__link">
    Evaluation Graph Correctness
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-safety" class="md-nav__link">
    Thread Safety
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe-mode" class="md-nav__link">
    Safe Mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluation-graph-invalidation" class="md-nav__link">
    Evaluation Graph Invalidation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#idle-actions" class="md-nav__link">
    Idle Actions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    Benefits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    Caveats
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-evaluators" class="md-nav__link">
    Custom Evaluators
  </a>
  
    <nav class="md-nav" aria-label="Custom Evaluators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gpu-override" class="md-nav__link">
    GPU Override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamics-evaluator" class="md-nav__link">
    Dynamics Evaluator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-evaluator" class="md-nav__link">
    Reference Evaluator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invisibility-evaluator" class="md-nav__link">
    Invisibility Evaluator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frozen-evaluator" class="md-nav__link">
    Frozen Evaluator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-frozen-attribute" class="md-nav__link">
    The Frozen Attribute
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operation" class="md-nav__link">
    Operation
  </a>
  
    <nav class="md-nav" aria-label="Operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-gathering-the-nodes" class="md-nav__link">
    Phase 1: Gathering The Nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-propagating-the-freezing" class="md-nav__link">
    Phase 2: Propagating The Freezing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-runtime-freezing" class="md-nav__link">
    Phase 3: Runtime Freezing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-options" class="md-nav__link">
    Setting Options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    Limitations
  </a>
  
    <nav class="md-nav" aria-label="Limitations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#curve-manager-evaluator" class="md-nav__link">
    Curve Manager Evaluator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-evaluators" class="md-nav__link">
    Other Evaluators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluator-conflicts" class="md-nav__link">
    Evaluator Conflicts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-extensions" class="md-nav__link">
    API Extensions
  </a>
  
    <nav class="md-nav" aria-label="API Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel-evaluation" class="md-nav__link">
    Parallel Evaluation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-gpu-deformers" class="md-nav__link">
    Custom GPU Deformers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-evaluator-api" class="md-nav__link">
    Custom Evaluator API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-basics" class="md-nav__link">
    The Basics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    API Reference
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#claiming-clusters" class="md-nav__link">
    Claiming clusters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduling" class="md-nav__link">
    Scheduling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution" class="md-nav__link">
    Execution
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simpleevaluator-api-example" class="md-nav__link">
    SimpleEvaluator API Example
  </a>
  
    <nav class="md-nav" aria-label="SimpleEvaluator API Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vp2-integration" class="md-nav__link">
    VP2 Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracking-topology" class="md-nav__link">
    Tracking Topology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profiling-plug-ins" class="md-nav__link">
    Profiling Plug-ins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling-your-scene" class="md-nav__link">
    Profiling Your Scene
  </a>
  
    <nav class="md-nav" aria-label="Profiling Your Scene">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-your-profile" class="md-nav__link">
    Understanding Your Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profiler-colors" class="md-nav__link">
    Profiler Colors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dg-evaluation" class="md-nav__link">
    DG Evaluation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#em-parallel-evaluation" class="md-nav__link">
    EM Parallel Evaluation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#em-parallel-evaluation-with-gpu-override" class="md-nav__link">
    EM Parallel Evaluation with GPU Override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#em-evaluation-cached-playback" class="md-nav__link">
    EM Evaluation Cached Playback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#em-vp2-hardware-cached-playback" class="md-nav__link">
    EM VP2 Hardware Cached Playback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluation-bound-performance" class="md-nav__link">
    Evaluation-Bound Performance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#render-bound-performance" class="md-nav__link">
    Render-Bound Performance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-and-restoring-profiles" class="md-nav__link">
    Saving and Restoring Profiles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-your-scene" class="md-nav__link">
    Troubleshooting Your Scene
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting Your Scene">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis-mode" class="md-nav__link">
    Analysis Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-execution-order" class="md-nav__link">
    Graph Execution Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-evaluation-toolkit" class="md-nav__link">
    The Evaluation Toolkit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-limitations" class="md-nav__link">
    Known Limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendices" class="md-nav__link">
    Appendices
  </a>
  
    <nav class="md-nav" aria-label="Appendices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#profiler-file-format" class="md-nav__link">
    Profiler File Format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-commands" class="md-nav__link">
    Debugging Commands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbcount" class="md-nav__link">
    dbcount
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbmessage" class="md-nav__link">
    dbmessage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbtrace" class="md-nav__link">
    dbtrace
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dgdebug" class="md-nav__link">
    dgdebug
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dgdirty" class="md-nav__link">
    dgdirty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dgeval" class="md-nav__link">
    dgeval
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dginfo" class="md-nav__link">
    dgInfo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dgmodified" class="md-nav__link">
    dgmodified
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek" class="md-nav__link">
    dbpeek
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-attributes" class="md-nav__link">
    dbpeek -op attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-cache" class="md-nav__link">
    dbpeek -op cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-cmdtracking" class="md-nav__link">
    dbpeek -op cmdTracking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-connections" class="md-nav__link">
    dbpeek -op connections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-data" class="md-nav__link">
    dbpeek -op data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-context" class="md-nav__link">
    dbpeek -op context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-edits" class="md-nav__link">
    dbpeek -op edits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-evalmgr" class="md-nav__link">
    dbpeek -op evalMgr
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-graph" class="md-nav__link">
    dbpeek -op graph
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-mesh" class="md-nav__link">
    dbpeek -op mesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-metadata" class="md-nav__link">
    dbpeek -op metadata
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-node" class="md-nav__link">
    dbpeek -op node
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-nodes" class="md-nav__link">
    dbpeek -op nodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-nodetracking" class="md-nav__link">
    dbpeek -op nodeTracking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dbpeek-op-plugs" class="md-nav__link">
    dbpeek -op plugs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#revisions" class="md-nav__link">
    Revisions
  </a>
  
    <nav class="md-nav" aria-label="Revisions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2020" class="md-nav__link">
    2020
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2019" class="md-nav__link">
    2019
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2018" class="md-nav__link">
    2018
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2017" class="md-nav__link">
    2017
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2016-extension-2" class="md-nav__link">
    2016 Extension 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2016" class="md-nav__link">
    2016
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              

                
                  <a href="https://github.com/mottosso/ragdoll/edit/main/docs/pages/parallel.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>Parallel</h1>
                
                <style>
h3, h4 {
    padding-top: 50px;
}
</style>

<h3 id="overview">Overview</h3>
<p>This guide describes the Maya features for accelerating playback and manipulation of animated scenes. It covers key concepts, shares best practices/usage tips, and lists known limitations that we aim to address in subsequent versions of Maya.</p>
<p>This guide will be of interest to riggers, TDs, and plug-in authors wishing to take advantage of speed enhancements in Maya.</p>
<p>If you would like an overview of related topics prior to reading this document, check out <a href="https://www.youtube.com/watch?v=KKC7A9bbUuk"><strong>Supercharged Animation Performance in Maya 2016</strong></a>.</p>
<h3 id="key-concepts">Key Concepts</h3>
<p>Starting from Maya 2016, Maya accelerates existing scenes by taking better advantage of your hardware. Unlike previous versions of Maya, which were limited to node-level parallelism, Maya now includes a mechanism for scene-level analysis and parallelization. For example, if your scene contains different characters that are unconstrained to one another, Maya can evaluate each character at the same time.</p>
<p>Similarly, if your scene has a single complex character, it may be possible to evaluate rig sub-sections simultaneously. As you can imagine, the amount of parallelism depends on how your scene has been constructed. We will get back to this later. For now, lets focus on understanding key Maya evaluation concepts.</p>
<p>At the heart of Mayas new evaluation architecture is an <strong>Evaluation Manager (EM)</strong>, responsible for handling the <em>parallel-friendly</em> representation of your scene. It maintains (and updates while the scene is edited) a few data structures (described below) used for efficient evaluation.</p>
<p>The basic description of the scene is the <strong>Dependency Graph (DG)</strong>, consisting of <strong>DG nodes</strong> and connections. Nodes can have multiple attributes, and instances of these attributes on a specific node are called <strong>plugs</strong>. The DG connections are at the <strong>plug</strong> level, that is, two nodes can be connected to one another multiple ways through different plugs. Generally speaking, these connections represent data flow through the nodes as they evaluate. The following image shows an example DG:</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167560-be566369-d249-45cf-aca7-7719badc4af4.png" /></p>
<p>The dotted arrows inside the nodes represent an implicit computation dependency between an output attribute (on the right of the node) and the input attributes (on the left) being read to compute the result stored in the output.</p>
<p>Before Parallel Maya, the DG was used to evaluate the scene using a <strong>Pull Model</strong> or <strong>Pull Evaluation</strong>. In this model, the data consumer (for instance the renderer) queries data from a given node. If the data is already evaluated, the consumer receives it directly. However, if the data is <strong>dirty</strong>, the node must first recompute it. It does so by pulling on the inputs required to compute the requested data. These inputs can also be dirty, in which case the evaluation request will then be forwarded to those dirty sources until it reaches the point where the data can be evaluated. The result then propagates back up in the graph, as the data is being pulled.</p>
<p>This evaluation model relies on the ability to mark node data as invalid and therefore requiring new evaluation. This mechanism is known as the <strong>Dirty Propagation</strong> in which the invalid data status propagates to all downstream dependencies. The two main cases where dirty propagation happened in the Pull Evaluation model were when:</p>
<ul>
<li>the current time is changed: in this case, animation curves no longer have the right value which depends on the current time. Therefore, dirty propagation starts from each animation curve and the dirty status is propagated through the graph to reach everything depending on time, directly or indirectly.</li>
<li>a value is changed on a node: whether the value is being changed through interactive manipulation or by a script, all data that depends on this new value must be recomputed. Therefore, dirty propagation starts from the edited plug and the dirty status is propagated through the graph to reach everything depending on the edited attribute.</li>
</ul>
<p>The Pull Evaluation model is not well suited for efficient parallel evaluation because of potential races that can arise from concurrent pull evaluations.</p>
<p>To have tighter control over evaluation, Maya now uses a <strong>Forward Evaluation</strong> model to enable concurrent evaluation of multiple nodes. The general idea is simple: if all a nodes dependencies have been evaluated <em>before</em> we evaluate the given node, pull evaluation will not be triggered when accessing evaluated node data, so evaluation remains contained in the node and is easier to run concurrently.</p>
<p>All data dependencies between the nodes must be known to apply this evaluation model, and this information is captured in the <strong>Evaluation Graph (EG)</strong>, containing <strong>Evaluation Nodes</strong>. The EM uses dirty propagation to capture dependency information between the nodes, as well as which attributes are animated. EG connections represent node-level dependencies; destination nodes employ data from source nodes to correctly evaluate the scene. One important distinction between the DG and the EG is that the former uses <strong>plug</strong>-level connections, while the latter uses <strong>node</strong>-level connections. For example, the previous DG would create the following EG:</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167562-6c8f2d42-6050-49d0-80f3-dbf70b5569b7.png" /></p>
<p>A valid EG may not exist or <a href="#evaluation-graph-invalidation">become invalid</a> for various reasons. For example, you have loaded a new scene and no EG has been built yet, or you have changed your scene, invalidating a prior EG. However, once the EG is built, unlike previous versions of Maya that propagated dirty on every frame, Maya now disables dirty propagation, reusing the EG until it becomes invalid.</p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>If your scene contains expression nodes that use <code>getAttr</code>, the DG graph will be missing explicit dependencies. This results in an incorrect EG. Expression nodes also reduce the amount of parallelism in your scenes (see Scheduling Types for details). Consider removing <code>getAttr</code> from expressions and/or using utility nodes.</p>
</div>
<p>While the EG holds the dependency information, it is not ready to be evaluated concurrently as-is. The EM must first create units of work that can be scheduled, that is, <strong>tasks</strong>. The main types of task created are:</p>
<ul>
<li><strong>Individual Nodes</strong>: in the simplest case, an evaluation node can be computed directly. The task therefore consists of evaluating all of its animated attributes.</li>
<li><strong>Cycle Clusters</strong>: depending on the scene, the EG may contain circular node-level dependencies. If this is the case, the EM creates clusters that group together nodes in the same cycle. At scene evaluation time, nodes in cycle clusters are evaluated serially before continuing with other parallel parts of the EG, hence the evaluation of a cycle cluster consisting of a single task. While node-level cycles are perfectly legal, creating scenes with attribute-level cycles should be avoided as this is unsupported and leads to unspecified behavior.</li>
<li><strong>Custom Evaluator Clusters</strong>: the EM supports the concept of <a href="#custom-evaluators"><strong>custom evaluators</strong></a> to override evaluation of sub-section of the EG. One example of this is the <a href="#gpu-override"><strong>GPU override</strong></a>, which uses your graphics cards graphics processing unit (GPU) to accelerate deformations. The custom evaluators will create clusters for nodes for which they take responsibility, and the EM creates a task for each of these clusters. At scene evaluation time, control is passed to the specific custom evaluator when the task is up to be executed.</li>
</ul>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167564-df85461a-a003-4e45-97e7-2a9f55024fc5.png" /></p>
<p>This step, called <strong>partitioning</strong>, is where the EM creates the individual pieces of work that will have to be executed. Each of these tasks will map to a <strong>Scheduling Node</strong> in the <strong>Scheduling Graph (SG)</strong>, where connections represent dependencies between the tasks:</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167565-e3ac6c7b-4a30-46e5-9079-196edd0480ba.png" /></p>
<p>The SG is an acyclic graph, otherwise it would be impossible to schedule nodes in a cycle since there would be no starting point for which all dependencies could be evaluated. In addition to the dependencies that come directly from the EG, the SG can have additional scheduling constraints to prevent concurrent evaluation of subsets of nodes (see Scheduling Types for details).</p>
<h3 id="supported-evaluation-modes">Supported Evaluation Modes</h3>
<p>Starting in Maya 2016, 3 evaluation modes are supported:</p>
<table>
<thead>
<tr>
<th align="left">Mode</th>
<th align="left">What does it do?</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>DG</strong></td>
<td align="left">Uses the legacy <strong>Dependency Graph</strong>-based evaluation of your scene. This was the default evaluation mode prior to Maya 2016</td>
</tr>
<tr>
<td align="left"><strong>Serial</strong></td>
<td align="left"><strong>Evaluation Manager Serial</strong> mode. Uses the EG but limits scheduling to a single core. Serial mode is a troubleshooting mode to pinpoint the source of evaluation errors.</td>
</tr>
<tr>
<td align="left"><strong>Parallel</strong></td>
<td align="left"><strong>Evaluation Manager Parallel</strong> mode. Uses the EG and schedules evaluation across all available cores. This mode is the new Maya default since 2016.</td>
</tr>
</tbody>
</table>
<p>When using either Serial or Parallel EM modes, you can also activate <strong>GPU Override</strong> to accelerate deformations on your GPU. You must be in Viewport 2.0 to use this feature (see <a href="#gpu-override">GPU Override</a>).</p>
<p>To switch between different modes, go to the Preferences window (<strong>Windows &gt; Settings/Preferences &gt; Preferences &gt; Animation</strong>). You can also use the <strong>evaluationManager</strong> MEL/Python command; see documentation for supported options.</p>
<p>To see the evaluation options that apply to your scene, turn on the Heads Up Display Evaluation options (<strong>Display &gt; Heads Up Display &gt; Evaluation</strong>).</p>
<h3 id="first-make-it-right-then-make-it-fast">First Make it Right Then Make it Fast</h3>
<p>Before discussing how to make your Maya scene faster using Parallel evaluation, it is important to ensure that evaluation in DG and EM modes generates the same results. If you see different results in the viewport during animation (as compared to previous versions of Maya), or tests reveal numerical errors, it is critical to understand the cause of these errors. Errors may be due to an incorrect EG, threading related problems, or other issues.</p>
<p>Below, we review <a href="#evaluation-graph-correctness"><strong>Evaluation Graph Correctness</strong></a> and <a href="#thread-safety"><strong>Thread Safety</strong></a>, two important concepts to understand errors.</p>
<h4 id="evaluation-graph-correctness">Evaluation Graph Correctness</h4>
<p>If you see evaluation errors, first test your scene in <strong>Serial</strong> evaluation mode (see <a href="#supported-evaluation-modes">Supported Evaluation Modes</a>). Serial evaluation mode uses the EM to build an EG of your scene, but limits evaluation to a single core to eliminate threading as the possible source of differences. Note that since Serial evaluation mode is provided for debugging, it has not been optimized for speed and scenes may run slower in Serial than in DG evaluation mode. This is expected.</p>
<p>If transitioning to Serial evaluation eliminates errors, this suggests that differences are most likely due to threading-related issues. However, if errors persist (even after transitioning to Serial evaluation) this suggests that the EG is incorrect for your scene. There are a few possible reasons for this:</p>
<p><strong>Custom Plugins.</strong> If your scene uses custom plug-ins that rely on the mechanism provided by the <code>MPxNode::setDependentsDirty</code> function to manage attribute dirtying, this may be the source of problems. Plug-in authors sometimes use <code>MPxNode::setDependentsDirty</code> to avoid expensive calculations in <code>MPxNode::compute</code> by monitoring and/or altering dependencies and storing computed results for later re-use.</p>
<p>Since the EM relies on dirty propagation to create the EG, any custom plug-in logic that alters dependencies may interfere with the construction of a correct EG. Furthermore, since the EM evaluation does not propagate dirty messages, any custom caching or computation in <code>MPxNode::setDependentsDirty</code> is not called while the EM is evaluating.</p>
<p>If you suspect that your evaluation errors are related to custom plug-ins, temporarily remove the associated nodes from your scene and validate that both DG and Serial evaluation modes generate the same result. Once you have made sure this is the case, revisit the plug-in logic. The <a href="#api-extensions">API Extensions</a> section covers Maya SDK changes that will help you adapt plug-ins to Parallel evaluation.</p>
<p>Another debugging option is to use scheduling type overrides to force custom nodes to be scheduled more conservatively. This approach enables the use of Parallel evaluation even if only some of the nodes are thread-safe. Scheduling types are described in more detail in the <a href="#thread-safety">Thread Safety</a> section.</p>
<p><strong>Errors in Autodesk Nodes.</strong> Although we have done our best to ensure that all out-of-the-box Autodesk Maya nodes correctly express dependencies, sometimes a scene uses nodes in an unexpected manner. If this is the case, we ask you make us aware of scenes where you encounter problems. We will do our best to address problems as quickly as possible.</p>
<h4 id="thread-safety">Thread Safety</h4>
<p>Prior to Maya 2016, evaluation was single-threaded and developers did not need to worry about making their code thread-safe. At each frame, evaluation was guaranteed to proceed serially and computation would finish for one node prior to moving onto another. This approach allowed for the caching of intermediate results in global memory and using external libraries without considering their ability to work correctly when called simultaneously from multiple threads.</p>
<p>These guarantees no longer apply. Developers working in recent versions of Maya must update plug-ins to ensure correct behavior during concurrent evaluation.</p>
<p>Two things to consider when updating plug-ins:</p>
<ul>
<li>
<p><strong>Different instances of a node type should not share resources.</strong> Unmanaged shared resources can lead to evaluation errors since different nodes, of the same type, can have their <code>compute()</code> methods called at the same time.</p>
</li>
<li>
<p><strong>Avoid non thread-safe lazy evaluation.</strong> In the EM, evaluation is scheduled from predecessors to successors on a per-node basis. Once computation has been performed for predecessors, results are cached, and made available to successors via connections. Any attempt to perform non-thread safe lazy evaluation could return different answers to different successors or, depending on the nature of the bug, instabilities.</p>
</li>
</ul>
<p>Heres a concrete example for a simple node network consisting of 4 nodes:</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167578-140556f0-319a-4a0c-80ab-963d4cf472f2.png" /></p>
<p>In this graph, evaluation first calculates outputs for Node1 (that is, Node1.A, Node1.B, Node1.C), followed by parallel evaluation of Nodes 2, 3, and 4 (that is, Read Node1.A to use in Node2, Read Node1.B to use in Node3, and so on).</p>
<p>Knowing that making legacy code thread-safe requires time, we have added new scheduling types to provide control over how the EM schedule nodes. Scheduling types provide a straightforward migration path, so you do not need to hold off on performance improvements, just because a few nodes still need work.</p>
<p>There are 4 scheduling types:</p>
<table>
<thead>
<tr>
<th align="left">Scheduling Type</th>
<th align="left">What are you telling the scheduler?</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>Parallel</strong></td>
<td align="left">Asserts that the node and all third-party libraries used by the node are thread-safe. The scheduler may evaluate any instances of this node at the same time as instances of other nodes without restriction.</td>
</tr>
<tr>
<td align="left"><strong>Serial</strong></td>
<td align="left">Asserts it is safe to run this node with instances of other nodes. However, all nodes with this scheduling type should be executed sequentially within the same evaluation chain.</td>
</tr>
<tr>
<td align="left"><strong>Globally Serial</strong></td>
<td align="left">Asserts it is safe to run this node with instances of other node types but only a single instance of this node type should be run at a time. Use this type if the node relies on static state, which could lead to unpredictable results if multiple node instances are simultaneously evaluated. The same restriction may apply if third-party libraries store state.</td>
</tr>
<tr>
<td align="left"><strong>Untrusted</strong></td>
<td align="left">Asserts this node is not thread-safe and that no other nodes should be evaluated while an instance of this node is evaluated. Untrusted nodes are deferred as much as possible (that is, until there is nothing left to evaluate that does not depend on them), which can introduce costly synchronization.</td>
</tr>
</tbody>
</table>
<p>By default, nodes scheduled as <strong>Serial</strong> provide a middle ground between performance and stability/safety. In some cases, this is too permissive and nodes must be downgraded to <strong>GloballySerial</strong> or <strong>Untrusted.</strong> In other cases, some nodes can be promoted to <strong>Parallel</strong>. As you can imagine, the more parallelism supported by nodes in your graph, the higher level of concurrency you are likely to obtain.</p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>When testing your plug-ins with Parallel Maya, a simple strategy is to schedule nodes with the most restrictive scheduling type (that is, <strong>Untrusted</strong>), and then validate that evaluation produces correct results. Raise individual nodes to the next scheduling level, and repeat the experiment.</p>
</div>
<p>There are three ways to alter the scheduling level of your nodes:</p>
<p><a href="#the-evaluation-toolkit"><strong>Evaluation Toolkit.</strong></a> Use this tool to query or change the scheduling type of different node types.</p>
<p><strong>C++/Python API methods.</strong> Use the OpenMaya API to specify the desired node scheduling by overriding the <code>MPxNode::schedulingType</code> method. This function should return one of the enumerated values specified by <code>MPxNode::schedulingType</code>. See the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_px_node_html">Maya MPxNode class reference</a> for more details.</p>
<p><strong>MEL/Python Commands.</strong> Use the evaluationManager command to change the scheduling type of nodes at runtime. Below, we illustrate how you can change the scheduling of scene transform nodes:</p>
<table>
<thead>
<tr>
<th align="left"><strong>Scheduling Type</strong></th>
<th align="left"><strong>Command</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>Parallel</strong></td>
<td align="left"><code>evaluationManager -nodeTypeParallel on "transform"</code></td>
</tr>
<tr>
<td align="left"><strong>Serial</strong></td>
<td align="left"><code>evaluationManager -nodeTypeSerialize on "transform"</code></td>
</tr>
<tr>
<td align="left"><strong>GloballySerial</strong></td>
<td align="left"><code>evaluationManager -nodeTypeGloballySerialize on "transform"</code></td>
</tr>
<tr>
<td align="left"><strong>Untrusted</strong></td>
<td align="left"><code>evaluationManager -nodeTypeUntrusted on "transform"</code></td>
</tr>
</tbody>
</table>
<p>The Evaluation Toolkit and MEL/Python Commands method to alter node scheduling level works using node type overrides. They add an override that applies to all nodes of a given type. Using C++/Python API methods and overriding the <code>MPxNode::schedulingType</code> function gives the flexibility to change the scheduling type for each node instance. For example, expression nodes are marked as <em>globally serial</em> if the expression outputs are a purely mathematical function of its inputs.</p>
<p>The expression engine is not thread-safe so only one expression can run at a time, but it can run in parallel with any other nodes. However, if the expression uses unsafe commands (expressions could use any command to access any part of the scene), the node is marked as <em>untrusted</em> because nothing can run while the expression is evaluated.</p>
<p>This changes the way scheduling types should be queried. Using the <code>evaluationManager</code> command with the above flags in query mode will return whether an override has been set on the node type, using either the Evaluation Toolkit or the MEL/Python commands.</p>
<p>The <a href="#the-evaluation-toolkit">Evaluation Toolkit</a> window lets you query both the override type on the node type (which cannot vary from one node of the same type to the other), or the actual scheduling type used for a node when building the scheduling graph (which can change from one node instance to the other).</p>
<h4 id="safe-mode">Safe Mode</h4>
<p>On rare occasions you may notice that Maya switches from Parallel to Serial evaluation during manipulation or playback. This is due to <strong>Safe Mode,</strong> which attempts to trap errors that possibly lead to instabilities. If Maya detects that multiple threads are attempting to simultaneously access a single node instance, evaluation will be forced to Serial execution to prevent problems.</p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>If Safe Mode forces your scene into Serial mode, the EM may not produce the expected incorrect results when manipulating. In such cases you can either disable the EM:</p>
</div>
<blockquote>
<p><code>cmds.evaluationManager(mode="off")</code></p>
<p>or disable EM-accelerated manipulation:</p>
<p><code>cmds.evaluationManager(man=0)</code></p>
</blockquote>
<p>While Safe Mode exposes many problems, it cannot catch them all. Therefore, we have also developed a special <a href="#analysis-mode"><strong>Analysis Mode</strong></a> that performs a more thorough (and costly) check of your scene. Analysis mode is designed for riggers/TDs wishing to troubleshoot evaluation problems during rig creation. Avoid using Analysis Mode during animation since it will slow down your scene.</p>
<h3 id="evaluation-graph-invalidation">Evaluation Graph Invalidation</h3>
<p>As <a href="#key-concepts">previously</a> described, the EG adds necessary node-level scheduling information to the DG. To make sure evaluation is correct, its critical the EG always be up-to-date, reflecting the state of the scene. The process of detecting things that have changed and rebuilding the EG is referred to as <em>graph invalidation</em>.</p>
<p>Different actions may invalidate the EG, including:</p>
<ul>
<li>Adding/removing nodes</li>
<li>Changing the scenes transformation (DAG) hierarchy</li>
<li>Adding/removing extension attributes</li>
<li>Loading an empty scene or opening a new file</li>
</ul>
<p>Other, less obvious, actions include:</p>
<ul>
<li><strong>Static animation curves</strong>. Although animation curves are time-dependent, DG evaluation treats curves with identical (static) keys as time-independent to avoid unnecessary calculations. The EG uses a similar optimization, excluding and avoiding scheduling of static animation curves. This keeps the EG compact, making it fast to build, schedule, and evaluate. A downside of this approach is that changes to static animation curves will cause the EG to become invalid; on time change Maya will rebuild the EG and determine if curves should be treated as time-dependent and added to the EG.</li>
<li><strong>Dirty propagation crossing the Evaluation Graph</strong>. The DG architecture allowed for implicit dependencies (that is, dependencies not expressed via connections), using them during dirty propagation. When dirty propagation is detected for these implicit dependencies, the EG will invalidate itself since this could signal the need to add new dependencies to the EG.</li>
</ul>
<p>Frequent graph invalidations may limit parallel evaluation performance gains or even slow it down (see <a href="#idle-actions">Idle Actions</a>), since Maya requires DG dirty propagation and evaluation to rebuild the EG. To avoid unwanted graph rebuilds, consider adding 2 keys, each with slightly different values, on rig attributes that you expect to use frequently. You can also lock static channels to prevent creation of static animation curves during keying. We expect to continue tuning this area of Maya, with the goal of making the general case as interactive as possible.</p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>You can use the <a href="http://help.autodesk.com/cloudhelp/2020/ENU/Maya-Tech-Docs/Commands/controller.html">controller</a> command to identify objects that are used as animation sources in your scene. If the <em>Include controllers in evaluation graph</em> option is set (see <strong>Windows &gt; Settings/Preferences &gt; Preferences</strong>, then <strong>Settings &gt; Animation</strong>), the objects marked as controllers will automatically be added to the evaluation graph even if they are not animated yet. This allows Parallel evaluation for manipulation even if they have not yet been keyed.</p>
</div>
<h3 id="idle-actions">Idle Actions</h3>
<p>In this section, we discuss the different idle actions available in Maya that helps rebuild the EG without any intervention from the user. Prior to Maya 2019, only one idle action, the EG rebuild, was available, but it was not enabled by default. Since Maya 2019, we have added another idle action, the EG preparation for manipulation, and both of these are enabled by default.</p>
<p>Here is a description of the idle actions:</p>
<table>
<thead>
<tr>
<th align="left"><strong>Idle Action</strong></th>
<th align="left"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>EG Rebuild</strong></td>
<td align="left">Builds the graph topology. This idle action is executed after a file load operation, or after a graph topology invalidation.</td>
</tr>
<tr>
<td align="left"><strong>EG Preparation for manipulation</strong></td>
<td align="left">Partitions and schedules the graph. This idle action is executed after a graph rebuild (either manually or through the idle action), or after a partitioning invalidation.</td>
</tr>
</tbody>
</table>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>You can use the <a href="http://help.autodesk.com/cloudhelp/2020/ENU/Maya-Tech-Docs/Commands/evaluationManager.html">evaluationManager</a> command to change which idle actions are enabled. You can enable and disable both idle actions individually.</p>
</div>
<h3 id="benefits">Benefits</h3>
<p>To make use of the Parallel Evaluation and GPU deformation during manipulation, the EG needs to be properly built, partitioned and scheduled, otherwise it will revert to DG. These idle actions allow the EG to automatically build and be ready to use when needed, since they are triggered at file load and after graph invalidation.</p>
<p>If you use <a href="#other-evaluators">Cached Playback</a>, your cache automatically refills, too. This way, you can start playing from cache as soon as the scene is loaded or after you modify to the scene.</p>
<h3 id="caveats">Caveats</h3>
<p>In a typical frame evaluation, temporary values that are set on keyed attributes are restored to their original values, that is, the values on their associated curves. With the idle actions, this is an unwanted behavior, otherwise you would not be able to do any modifications to keyed attributes. To circumvent that issue, we had to add some special behaviougs One of these is the dirty propagation from stale plugs after an idle preparation for manipulation. When not in idle preparation for manipulation, this operation is done during the partitioning and scheduling phase. With idle preparation for manipulation, this operation is done at the next complete evaluation. Therefore, if you have many static curves, you might experience a slowdown on the first frame of playback.</p>
<p>If you do frequent operations that invalidate the graph or partitioning, you may experience some slowdowns due to the graph always being rebuilt. In such cases, it is advised that you disable the offending idle action until you are done.</p>
<h3 id="custom-evaluators">Custom Evaluators</h3>
<p>In this section, we describe mechanisms to perform targeted evaluation of node sub-graphs. This approach is used by Maya to accelerate deformations on the GPU and to catch evaluation errors for scenes with specific nodes. Maya 2017 also introduced <a href="#custom-evaluator-api">new Open API extensions</a>, allowing user-defined custom evaluators.</p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>Use the evaluator command to query the available/active evaluators or modify currently active evaluators. Some evaluators support using the <em>nodeType</em> flag to filter out or include nodes of certain types. Query the <em>info</em> flag on the evaluator for more information on what it supports.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># Returns a list of all currently available evaluators.</span>
<span class="kn">import</span> <span class="nn">maya.cmds</span> <span class="k">as</span> <span class="nn">cmds</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">evaluator</span><span class="p">(</span> <span class="n">query</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="c1"># Result: [u&#39;invisibility&#39;,</span>
<span class="sa">u</span><span class="s1">&#39;frozen&#39;</span><span class="p">,</span>
<span class="o">...</span>
<span class="sa">u</span><span class="s1">&#39;transformFlattening&#39;</span><span class="p">,</span>
<span class="sa">u</span><span class="s1">&#39;pruneRoots&#39;</span><span class="p">]</span> <span class="c1">#</span>

<span class="c1"># Returns a list of all currently enabled evaluators.</span>
<span class="n">cmds</span><span class="o">.</span><span class="n">evaluator</span><span class="p">(</span> <span class="n">query</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="c1"># Result: [u&#39;invisibility&#39;,</span>
<span class="sa">u</span><span class="s1">&#39;timeEditorCurveEvaluator&#39;</span><span class="p">,</span>
<span class="o">...</span>
<span class="sa">u</span><span class="s1">&#39;transformFlattening&#39;</span><span class="p">,</span>
<span class="sa">u</span><span class="s1">&#39;pruneRoots&#39;</span><span class="p">]</span> <span class="c1">#</span>
</code></pre></div>
<p><strong>Note: Enabling or disabling custom evaluators only applies to the current Maya session: the state is not saved in the scene nor in the user preferences.</strong> The same applies to configuration done using the <code>evaluator</code> command and the <em>configuration</em> flag.</p>
<h4 id="gpu-override">GPU Override</h4>
<p>Maya contains a custom <strong>deformer evaluator</strong> that accelerates deformations in Viewport 2.0 by targeting deformation to the GPU. GPUs are ideally suited to tackle problems such as mesh deformations that require the same operations on streams of vertex and normal data. We have included GPU implementations for several of the most commonly-used deformers in animated scenes: <strong>skinCluster</strong>, <strong>blendShape</strong>, <strong>cluster</strong>, <strong>tweak</strong>, <strong>groupParts</strong>, <strong>softMod</strong>, <strong>deltaMush</strong>, <strong>lattice</strong>, <strong>nonLinear</strong> and <strong>tension</strong>.</p>
<p>Unlike Mayas previous deformer stack that performed deformations on the CPU and subsequently sent deformed geometry to the graphics card for rendering, the GPU override sends <em>undeformed</em> geometry to the graphics card, performs deformations in OpenCL and then hands off the data to Viewport 2.0 for rendering without read-back overhead. We have observed substantial speed improvements from this approach in scenes with dense geometry.</p>
<p>Even if your scene uses only supported deformers, GPU override may not be enabled due to the use of unsupported node features in your scene. For example, with the exception of softMod, there is no support for incomplete group components. Additional deformer-specific limitations are listed below:</p>
<p><strong>Deformer</strong></p>
<p><strong>Limitation(s)</strong></p>
<p><strong>skinCluster</strong></p>
<p>The following attribute values are ignored:</p>
<p>- bindMethod</p>
<p>- bindPose</p>
<p>- bindVolume</p>
<p>- dropOff</p>
<p>- heatmapFalloff</p>
<p>- influenceColor</p>
<p>- lockWeights</p>
<p>- maintainMaxInfluences</p>
<p>- maxInfluences</p>
<p>- nurbsSamples</p>
<p>- paintTrans</p>
<p>- smoothness</p>
<p>- weightDistribution</p>
<p><strong>blendShape</strong></p>
<p>The following attribute values are ignored:</p>
<p>- baseOrigin</p>
<p>- icon</p>
<p>- normalizationId</p>
<p>- origin</p>
<p>- parallelBlender</p>
<p>- supportNegativeWeights</p>
<p>- targetOrigin</p>
<p>- topologyCheck</p>
<p><strong>cluster</strong></p>
<p>n/a</p>
<p><strong>tweak</strong></p>
<p>Only relative mode is supported. relativeTweak must be set to 1.</p>
<p><strong>groupParts</strong></p>
<p>n/a</p>
<p><strong>softMod</strong></p>
<p>Only volume falloff is supported when distance cache is disabled</p>
<p>Falloff must occur on all axes</p>
<p>Partial resolution must be disabled</p>
<p><strong>deltaMush</strong></p>
<p>n/a</p>
<p><strong>lattice</strong></p>
<p>n/a</p>
<p><strong>nonLinear</strong></p>
<p>n/a</p>
<p><strong>tension</strong></p>
<p>n/a</p>
<p>A few other reasons that can prevent GPU override from accelerating your scene:</p>
<ul>
<li>
<p><strong>Meshes not sufficiently dense.</strong> Unless meshes have a large number of vertices, it is still faster to perform deformations on the CPU. This is due to the driver-specific overhead incurred when sending data to the GPU for processing. For deformations to happen on the GPU, your mesh needs over 500/2000 vertices, on AMD/NVIDIA hardware respectively. Use the <code>MAYA_OPENCL_DEFORMER_MIN_VERTS</code> environment variable to change the threshold. Setting the value to 0 sends all meshes connected to supported deformation chains to the GPU.</p>
</li>
<li>
<p><strong>Downstream graph nodes required deformed mesh results.</strong> Since GPU read-back is a known bottleneck in GPGPU, no node, script, or Viewport can read the mesh data computed by the GPU override. This means that GPU override is unable to accelerate portions of the EG upstream of deformation nodes, such as follicle or pointOnPolyConstraint, that require information about the deformed mesh. We will re-examine this limitation as software/hardware capabilities mature. When diagnosing GPU Override problems, this situation may appear as an unsupported fan-out pattern. See <a href="http://help.autodesk.com/cloudhelp/2020/ENU/Maya-Tech-Docs/Commands/deformerEvaluator.html">deformerEvaluator</a> command, below, for details.</p>
</li>
<li>
<p><strong>Animated Topology.</strong> If your scene animates the number of mesh edges, vertices, and/or faces during playback, corresponding deformation chains are removed from the GPU deformation path.</p>
</li>
<li>
<p><strong>Maya Catmull-Clark Smooth Mesh Preview is used.</strong> We have included acceleration for OpenSubDiv (OSD)-based smooth mesh preview, however there is no support for Mayas legacy Catmull-Clark. To take advantage of OSD OpenCL acceleration, select <strong>OpenSubDiv Catmull-Clark</strong> as the subdivision method and make sure that <strong>OpenCL Acceleration</strong> is selected in the OpenSubDiv controls.</p>
</li>
<li>
<p><strong>Unsupported streams are found.</strong> Depending on which drawing mode you select for your geometry (for example, shrunken faces, hedge-hog normals, and so on) and the material assigned, Maya must allocate and send different streams of data to the graphics card. Since we have focused our efforts on common settings used in production, GPU override does not currently handle all stream combinations. If meshes fail to accelerate due to unsupported streams, change display modes and/or update the geometry material.</p>
</li>
<li>
<p><strong>Back face culling is enabled.</strong></p>
</li>
<li>
<p><strong>Driver-related issues.</strong> We are aware of various hardware issues related to driver support/stability for OpenCL. To maximize Mayas stability, we have disabled GPU Override in the cases that will lead to problems. We expect to continue to eliminate restrictions in the future and are actively working with hardware vendors to address detected driver problems.</p>
</li>
</ul>
<p>You can also increase support for new custom/proprietary deformers by using new API extensions (refer to <a href="#custom-gpu-deformers">Custom GPU Deformers</a> for details).</p>
<p>If you enable GPU Override and the HUD reports <em>Enabled (0 k)</em>, this indicates that no deformations are happening on the GPU. There could be several reasons for this, such as those mentioned above.</p>
<p>To troubleshoot factors that limit the use of GPU override for your particular scene, use the <a href="http://help.autodesk.com/cloudhelp/2020/ENU/Maya-Tech-Docs/Commands/deformerEvaluator.html">deformerEvaluator</a> command. Supported options include:</p>
<p><strong>Command</strong></p>
<p><strong>What does it do?</strong></p>
<p><code>deformerEvaluator</code></p>
<p>Prints the chain or each selected node is not supported.</p>
<p><code>deformerEvaluator -chains</code></p>
<p>Prints all active deformation chains.</p>
<p><code>deformerEvaluator -meshes</code></p>
<p>Prints a chain for each mesh or a reason if it is not supported.</p>
<h4 id="dynamics-evaluator">Dynamics Evaluator</h4>
<p>Starting in Maya 2017, the dynamics evaluator fully supports parallel evaluation of scenes with Nucleus (nCloth, nHair, nParticles), Bullet, and Bifrost dynamics. Legacy dynamics nodes (for example, particles, fluids) remain unsupported. If the dynamics evaluator finds unsupported node types in the EG, Maya will revert to DG-based evaluation. The dynamics evaluator also manages the tricky computation necessary for correct scene evaluation. This is one of the ways custom evaluators can be used to change Mayas default evaluation behavior.</p>
<p>The dynamics evaluator supports several configuration flags to control its behavior.</p>
<p><strong>Flag</strong></p>
<p><strong>What does it do?</strong></p>
<p><code>disablingNodes</code></p>
<p>specifies the set of nodes that will force the dynamics evaluator to disable the EM. Valid values are: <code>legacy2016</code>, <code>unsupported</code>, and <code>none</code>.</p>
<p><code>handledNodes</code></p>
<p>specifies the set of nodes that are going to be captured by the dynamics evaluator and scheduled in clusters that it will manage. Valid values are: <code>dynamics</code> and <code>none</code>.</p>
<p><code>action</code></p>
<p>specifies how the dynamics evaluator will handle its nodes. Valid values are: <code>none</code>, <code>evaluate</code>, and <code>freeze</code>.</p>
<p>In Maya 2017, the default configuration corresponds to:</p>
<div class="codehilite" style="background: #272822"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;disablingNodes=unsupported&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;handledNodes=dynamics&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;action=evaluate&quot;)
</code></pre></div>

<p>where unsupported (that is, blacklisted) nodes are:</p>
<ul>
<li>collisionModel</li>
<li>dynController</li>
<li>dynGlobals</li>
<li>dynHolder</li>
<li>fluidEmitter</li>
<li>fluidShape</li>
<li>membrane</li>
<li>particle (unless also a nBase)</li>
<li>rigidNode</li>
<li>rigidSolver</li>
<li>spring</li>
<li>nodes derived from the above</li>
</ul>
<p>This configuration disables evaluation if any unsupported nodes are encountered, and performs evaluation for the other handled nodes in the scene.</p>
<p>To revert to Maya 2016 / 2016 Extension 2 behavior, use the configuration:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;disablingNodes=legacy2016&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;handledNodes=none&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;action=none&quot;)
</code></pre></div>

<p>where unsupported (that is, blacklisted) nodes are:</p>
<ul>
<li>field</li>
<li>fluidShape</li>
<li>geoConnector</li>
<li>nucleus</li>
<li>particle</li>
<li>pointEmitter</li>
<li>rigidSolver</li>
<li>rigidBody</li>
<li>nodes derived from the above</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>To get a list of nodes that cause the dynamics evaluator to disable the EM in its present configuration, use the following command:</p>
</div>
<blockquote>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(name=&quot;dynamics&quot;, valueName=&quot;disabledNodes&quot;, query=True)
</code></pre></div>

</blockquote>
<p>You can configure the dynamics evaluator to ignore unsupported nodes. If you want to try Parallel evaluation on a scene where it is disabled because of unsupported node types, use the following commands:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;disablingNodes=none&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;handledNodes=dynamics&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;action=evaluate&quot;)
</code></pre></div>

<p><strong>Note: Using the dynamics evaluator on unsupported nodes may cause evaluation problems and/or application crashes; this is unsupported behavior. Proceed with caution.</strong></p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>If you want the dynamics evaluator to skip evaluation of all dynamics nodes in the scene, use the following commands:</p>
</div>
<blockquote>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;disablingNodes=unsupported&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;handledNodes=dynamics&quot;)
cmds.evaluator(name=&quot;dynamics&quot;, c=&quot;action=freeze&quot;)
</code></pre></div>

<p>This can be useful to quickly disable dynamics when the simulation impacts animation performance.</p>
</blockquote>
<p>Dynamics simulation results are very sensitive to evaluation order, which may differ between DG and EM-based evaluation. Even for DG-based evaluation, evaluation order may depend on multiple factors. For example, in DG-mode when rendering simulation results to the Viewport, the evaluation order may be different than when simulation is performed in headless mode. Though EM-based evaluation results are not guaranteed to be identical to DG-based, evaluation order is consistent; once the evaluation order is scheduled by the EM, it will remain consistent regardless of whether results are rendered or Maya is used in batch. This same principle applies to non-dynamics nodes that are order-dependent.</p>
<h4 id="reference-evaluator">Reference Evaluator</h4>
<p>When a reference is unloaded it leaves several nodes in the scene representing reference edits to preserve. Though these nodes may inherit animation from upstream nodes, they do not contribute to what is rendered and can be safely ignored during evaluation. The reference evaluator ensures all such nodes are skipped during evaluation.</p>
<h4 id="invisibility-evaluator">Invisibility Evaluator</h4>
<p>Toggling scene object visibility is a critical artist workflow used to reduce visual clutter and accelerate performance. To bring this workflow to parallel evaluation, Maya 2017 and above includes the invisibility evaluator, whose goal is to skip evaluation of any node that does not contribute to a visible object.</p>
<p>The invisibility evaluator will skip evaluation of DAG nodes meeting any of the below criteria:</p>
<ul>
<li><code>visibility</code> attribute is false.</li>
<li><code>intermediateObject</code> attribute is true.</li>
<li><code>overrideEnabled</code> attribute is true and <code>overrideVisibility</code> attribute is false.</li>
<li>node belongs to a display layer whose <code>enabled</code> attribute is true and <code>visibility</code> attribute is false.</li>
<li>every instance path contains at least one node for which one of the above statements are true.</li>
</ul>
<p>As of Maya 2018, the invisibility evaluator supports the <code>isolate select</code> method of hiding objects. If there is only a single Viewport, and it has one or more objects isolated, then all of the other, unrelated objects are considered invisible by the evaluator.</p>
<p>There is also support in Maya (2018 and up) for the <code>animated</code> attribute on expression nodes. When this attribute is set to 1, the expression node is not skipped by the invisibility evaluator, even if only invisible objects are connected to it.</p>
<blockquote>
<p><strong>Note:</strong> The default value of the <code>animated</code> attribute is 1, so in an expression-heavy scene you may see a slowdown from Maya 2017 to Maya 2018. To restore performance, run the script below to disable this attribute on all expression nodes. (It is only required when the expression has some sort of side-effect external to the connections, such as printing a message or checking a cache file size.)</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>for node in cmds.ls( type=&#39;expression&#39; ):
    cmds.setAttr( &#39;{}.animated&#39;.format(node), 0 )
</code></pre></div>

<p><strong>Tip:</strong> The invisibility evaluator is off by default in Maya 2017. Use the <a href="#the-evaluation-toolkit">Evaluation Toolkit</a> or this:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(enable=True, name=&#39;invisibility&#39;)
</code></pre></div>

<p>to enable the evaluator.</p>
</blockquote>
<p>The invisibility evaluator only considers static visibility; nodes with animated visibility are still evaluated, even if nodes meet the above criteria. If nodes are in a cycle, all cycle nodes must be considered invisible for evaluation to be skipped. Lastly, if a node is instanced and has at least one visible path upward, then all upward paths will be evaluated.</p>
<blockquote>
<p><strong>Tip:</strong> The invisibility evaluator determines visibility solely from the nodes visibility state; if your UI or plug-in code requires invisible nodes to evaluate, do not use the invisibility evaluator.</p>
</blockquote>
<h4 id="frozen-evaluator">Frozen Evaluator</h4>
<p>The frozen evaluator allows users to tag EG subsections as not needing evaluation. It enhances the <code>frozen</code> attribute by propagating the frozen state automatically to related nodes, according to the rules defined by the evaluators configuration. It should only be used by those comfortable with the concepts of connection and propagation in the DAG and Evaluation Graph. Many users may prefer the invisibility evaluator; it is a simpler interface/workflow for most cases.</p>
<h3 id="the-frozen-attribute">The Frozen Attribute</h3>
<p>The frozen attribute has existed on nodes since Maya 2016. It can be used to control whether node is evaluated in Serial or Parallel EM evaluation modes. In principle, when the frozen attribute is set, the EM skips evaluation of that node. However, there are additional nuances that impact whether or not this is the case:</p>
<ul>
<li>Everything downstream of frozen nodes is still evaluated, unless they also have the frozen attribute set, or they are affected by the frozen evaluator as described below.</li>
<li>Some nodes may perform optimizations that leave their outputs invalid and susceptible to change once evaluated. Freezing these nodes may have unexpected results as nothing preserves the old values. See the documentation on the nodeState attribute for ways to specifically enable caching for nodes you want to freeze.</li>
<li>You may have inconsistent per-frame results when the frozen attribute is animated. The node freezes when the attribute is set, so if you jump from frame to frame, your object state reflects the last time you visited in an unfrozen state. Playback is only consistent if your object is not frozen from the first frame.</li>
<li>When the frozen node is in the middle of a cycle, it is not respected. Cycles evaluate using the pull model, which does not respect the frozen attribute value.</li>
<li>Custom evaluators may or may not respect the frozen attribute value. Take this into consideration as part of their implementation.</li>
</ul>
<blockquote>
<p><strong>Warning:</strong> All the frozen attribute does is skip evaluation, nothing is done to preserve the current node data during file store; if you load a file with frozen attributes set, the nodes may not have the same data as when you stored them.</p>
</blockquote>
<h3 id="operation">Operation</h3>
<p>The evaluation manager does not evaluate any node that has its <code>frozen</code> attribute set to True, referred to here as <strong>explicitly frozen nodes</strong>. An <strong>implicitly frozen node</strong> is one that is disabled because of the operation of the frozen evaluator, but whose <code>frozen</code> attribute is not set to True. When the frozen evaluator is enabled it will also prevent evaluation of related nodes according to the rules corresponding to the enabled options, in any combination.</p>
<p>The frozen evaluator operates in three phases. In phase one, it gathers together all of the nodes flagged by the invisible and displayLayers options as being marked for freezing. In phase two, it propagates the freezing state outwards through the evaluation graph according to the values of the downstream and upstream options.</p>
<h4 id="phase-1-gathering-the-nodes">Phase 1: Gathering The Nodes</h4>
<p>The list of nodes for propagation is gathered as follows:</p>
<ul>
<li>The nodes with their <code>frozen</code> attribute set to True are found. (<strong>Note:</strong> This does not include those whose frozen attribute is animated. They are handled via Phase 3.)</li>
<li>If the invisible option is True then any node that is explicitly frozen and invisible (directly, or if its parents are all invisible) will have all of its DAG descendants added to the list of nodes for Phase 2.</li>
<li>If the displayLayers option is True then any node that is a member of a display layer that is explicitly frozen, enabled, and invisible will have it, and all its DAG descendants added to the list of nodes for Phase 2.</li>
</ul>
<h4 id="phase-2-propagating-the-freezing">Phase 2: Propagating The Freezing</h4>
<p>The list gathered by Phase 1 will all be implicitly frozen. In addition, the downstream and upstream options may implicitly freeze nodes related to them. For each of the nodes gathered so far, the evaluation graph will be traversed in both directions, implicitly freezing nodes encountered according to the following options:</p>
<ul>
<li><strong>downstream</strong> option value<ul>
<li><em>none</em> : No further nodes downstream in the EG will be implicitly frozen</li>
<li><em>safe</em> : Nodes downstream in the EG will be implicitly frozen only if every one of their upstream nodes has already been implicitly or explicitly frozen</li>
<li><em>force</em> : Nodes downstream in the EG will be implicitly frozen</li>
</ul>
</li>
<li><strong>upstream</strong> option value<ul>
<li><em>none</em> : No further nodes upstream in the EG will be implicitly frozen</li>
<li><em>safe</em> : Nodes upstream in the EG will be implicitly frozen only if every one of their downstream nodes has already been implicitly or explicitly frozen</li>
<li><em>force</em> : Nodes upstream in the EG will be implicitly frozen</li>
</ul>
</li>
</ul>
<h4 id="phase-3-runtime-freezing">Phase 3: Runtime Freezing</h4>
<p>If a node has its frozen or visibility states animated, the evaluator still has to schedule it. The runtime freezing can still assist at this point in preventing unnecessary evaluation. Normally any explicitly frozen node will have its evaluation skipped, with all other nodes evaluating normally. When the runtime option is enabled, after skipping the evaluation of an explicitly frozen node no further scheduling of downstream nodes will occur. As a result, if the downstream nodes have no other unfrozen inputs they will also be skipped.</p>
<p><strong>Note:</strong> The runtime option does not really modify the evaluator operation, it modifies the scheduling of nodes for evaluation. You will not see nodes affected by this option in the evaluator information (for example, the output from <code>cmds.evaluator( query=True, clusters=True, name='frozen' )</code>)</p>
<h3 id="setting-options">Setting Options</h3>
<p>Options can be set for the frozen evaluator in one of two ways:</p>
<ul>
<li>
<p>Accessing them through the <a href="#the-evaluation-toolkit">Evaluation Toolkit</a></p>
</li>
<li>
<p>Using the evaluator commands configuration option:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator( name=&#39;frozen&#39;, configuration=&#39;KEY=VALUE&#39; )
</code></pre></div>

</li>
</ul>
<p>Legal KEY and VALUE values are below, and correspond to the options as described above:</p>
<p>KEY</p>
<p>VALUES</p>
<p>DEFAULT</p>
<p>runtime</p>
<p>True/False</p>
<p>False</p>
<p>invisible</p>
<p>True/False</p>
<p>False</p>
<p>displayLayers</p>
<p>True/False</p>
<p>False</p>
<p>downstream</p>
<p>off/safe/force</p>
<p>off</p>
<p>upstream</p>
<p>off/safe/force</p>
<p>off</p>
<p>Unlike most evaluators the frozen evaluator options are stored in user preferences and persists between sessions.</p>
<h3 id="limitations">Limitations</h3>
<ul>
<li>You must set at least one <code>frozen</code> attribute to True to instruct the frozen evaluator to shut off evaluation on affected nodes. The most practical use of this would be on a display layer so that nodes can be implicitly frozen as a group.</li>
<li>If the <code>frozen</code> attribute, or any of the attributes used to define related implicit nodes for freezing (for example, <code>visibility</code>) are animated then the evaluator will <strong>not</strong> remove them from evaluation. They will still be scheduled and only the <strong>runtime</strong> option will help in avoiding unnecessary evaluation.</li>
<li>Cycle members are not frozen by the evaluator unless every input to the cycle is frozen. This is a design choice to reflect that as cycles evaluate as a unit, it is impossible to freeze individual members of a cycle. It must be all or nothing.</li>
</ul>
<h4 id="curve-manager-evaluator">Curve Manager Evaluator</h4>
<p>The curve manager evaluator can be used to include additional nodes in the Evaluation Graph, which can have two main benefits:</p>
<ul>
<li>The additional nodes can be manipulated using parallel evaluation and GPU deformation, which can result in higher responsiveness during interactive manipulation.</li>
<li>Fewer Evaluation Graph rebuilds can result, since static nodes can already be included in the Evaluation Graph.</li>
</ul>
<p>To achieve those benefits efficiently, the curve manager evaluator performs two main tasks:</p>
<ul>
<li>During Evaluation Graph construction, it triggers dirty propagation from extra nodes so they are included in the graph construction process and the resulting Evaluation Graph.</li>
<li>During scene evaluation, it handles the evaluation of some of those extra nodes to maintain performance, since they do not really need to be evaluated.</li>
</ul>
<p>To illustrate this result, lets compare the three following situations.</p>
<ol>
<li>A scene where all controllers have a single key (that is, static animation curves). Since the resulting animation curves are constant, they are considered static and are not included in the Evaluation Graph. Playback will have nothing to evaluate.</li>
<li>A scene where all controllers have keys of different values (that is, animated curves). Therefore, they will be included in the Evaluation Graph and playback will evaluate everything.</li>
<li>A scene where all controllers have a single key (that is, static animation curves), but where the curve manager evaluator is used to prepopulate the Evaluation Graph with those static curves.</li>
</ol>
<p>The third situation is where we are trying to take advantage of the curve manager evaluator to have an Evaluation Graph that is already set up to allow parallel evaluation when the controllers will be manipulated.</p>
<p>The following table summarizes the differences between the situations and the compromises provided by the curve manager evaluator.</p>
<p><strong>Situation</strong></p>
<p><strong># of nodes in EG</strong></p>
<p><strong>Playback</strong></p>
<p><strong>EM Manip</strong></p>
<p><strong>Rebuild when keying</strong></p>
<p>Static curves + curve manager off</p>
<p>Lowest</p>
<p>Fastest</p>
<p>No</p>
<p>Yes</p>
<p>Animated curves</p>
<p>Highest</p>
<p>Slowest</p>
<p>Yes</p>
<p>No</p>
<p>Static curves + curve manager on</p>
<p>Highest</p>
<p>Middle</p>
<p>Yes</p>
<p>No</p>
<p>In summary, the curve manager evaluator benefits from having the Evaluation Graph already populated with nodes so it is ready to evaluate interactive manipulation, while paying as little of a cost as possible for those constant nodes during playback.</p>
<p>It can be activated using:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(
    name=&quot;curveManager&quot;,
    enable=True
    )
cmds.evaluator(
    name=&quot;curveManager&quot;,
    configuration=&quot;forceAnimatedCurves=keyed&quot;
    )
</code></pre></div>

<p>The available values for <code>forceAnimatedCurves</code> are:</p>
<ul>
<li><em>none</em> : No curve will be forced in the evaluation graph.</li>
<li><em>controller</em> : Curves connected to controller nodes will be forced in the evaluation graph. This is basically a generalization of the controller concept.</li>
<li><em>keyed</em> : Keyed static curves, that is, curves with a single key or multiple keys with the same value, will be forced in the evaluation graph.</li>
<li><em>all</em> : All curves are forced in the evaluation graph.</li>
</ul>
<p>Another option, <code>forceAnimatedNodes</code>, can be used:</p>
<ul>
<li><em>none</em> : No node will be forced in the evaluation graph.</li>
<li><em>forcedAnimatedAttribute</em> : Nodes with the forced-animated attribute set to true will be forced in the evaluation graph.</li>
</ul>
<p>This allows tagging nodes to be added with a boolean dynamic attribute. By default, the name of this attribute is <code>forcedAnimated</code>. If it is present on a node and set to true, the node is added to the graph. The name of the attribute can be controlled by using the <em>forcedAnimatedAttributeName</em> option.</p>
<p>By default, the curve manager evaluator tries to skip the evaluation of the static parts of the graph. For debugging or performance measurement purposes, this optimization can be disabled:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(
    name=&quot;curveManager&quot;,
    configuration=&quot;skipStaticEvaluation=disable&quot;
    )
</code></pre></div>

<h4 id="other-evaluators">Other Evaluators</h4>
<p>In addition to evaluators described above, additional evaluators exist for specialized tasks:</p>
<p><strong>Evaluator</strong></p>
<p><strong>What does it do?</strong></p>
<p><strong>cache</strong></p>
<p>Constitutes the foundation of Cached Playback. See the <a href="http://download.autodesk.com/us/company/files/2020/MayaCachedPlaybackWhitePaper.html#overview">Maya Cached Playback whitepaper</a> for more information.</p>
<p><strong>timeEditorCurveEvaluator</strong></p>
<p>Finds all paramCurves connected to time editor nodes and puts them into a cluster that will prevent them from evaluating at the current time, since the time editor will manage their evaluation.</p>
<p><strong>ikSystem</strong></p>
<p>Automatically disables the EM when a multi-chain solver is present in the EG. For regular IK chains it will perform any lazy update prior to parallel execution.</p>
<p><strong>disabling</strong></p>
<p>Automatically disables the EM if user-specified nodes are present in the EG. This evaluator is used for troubleshooting purposes. It allows Maya to keep working stably until issues with problem nodes can be addressed.</p>
<p><strong>hik</strong></p>
<p>Handles the evaluation of HumanIK characters in an efficient way by recognizing HumanIK common connection patterns.</p>
<p><strong>cycle</strong></p>
<p>Unrolls cycle clusters to augment the opportunity for parallelism and improve performance. Likely gives the best performance improvements when large cycle clusters are present in the scene. <strong>Prototype, work in progress.</strong></p>
<p><strong>transformFlattening</strong></p>
<p>Consolidates deep transform hierarchies containing animated parents and static children, leading to faster evaluation. Consolidation takes a snapshot of the relative parent/child transformations, allowing concurrent evaluation of downstream nodes.</p>
<p><strong>pruneRoots</strong></p>
<p>We found that scenes with several thousand paramCurves become bogged down because of scheduling overhead from resulting EG nodes and lose any potential gain from increased parallelism. To handle this situation, special clusters are created to group paramCurves into a small number of evaluation tasks, thus reducing overhead.</p>
<p>Custom evaluator names are subject to change as we introduce new evaluators and expand these functionalities.</p>
<h4 id="evaluator-conflicts">Evaluator Conflicts</h4>
<p>Sometimes, multiple evaluators will want to claim responsibility for the same node(s). This can result in conflict, and negatively impact performance. To avoid these conflicts, upon registration each evaluator is associated with a priority; nodes are assigned to the evaluator with the highest priority. Internal evaluators have been ordered to prioritize correctness and stability over speed.</p>
<h3 id="api-extensions">API Extensions</h3>
<p>Several API extensions and tools have been added to help you make the most of the EM in your pipeline. This section reviews API extensions for <strong>Parallel Evaluation</strong>, <strong>Custom GPU Deformers</strong>, <strong>Custom Evaluator API</strong>, <strong>VP2 Integration</strong> and <strong>Profiling Plug-ins</strong>.</p>
<h4 id="parallel-evaluation">Parallel Evaluation</h4>
<p>If your plug-in plays by the DG rules, you will not need many changes to make the plug-in work in Parallel mode. Porting your plug-in so that it works in Parallel may be as simple as recompiling it against the latest version of OpenMaya!</p>
<p>If the EM generates different results than DG-based evaluation, make sure that your plug-in:</p>
<ul>
<li>
<p><strong>Overrides <code>MPxNode::compute()</code>.</strong> This is especially true of classes extending <code>MPxTransform</code> which previously relied on <code>asMatrix()</code>. See the rockingTransform SDK sample. For classes deriving from <strong><code>MPxDeformerNode</code></strong> and <strong><code>MPxGeometryFilter</code></strong>, override the <code>deform()</code> method.</p>
</li>
<li>
<p><strong>Handles requests for evaluation at all levels of the plug tree.</strong> While the DG can request plug values at any level, the EM always requests the root plug. For example, for plug N.gp[0].p[1] your compute() method must handle requests for evaluation of N.gp, N.gp[0], N.gp[0].p, and N.gp[0].p[1].</p>
</li>
</ul>
<p>If your plug-in relies on custom dependency management, you need to use new API extensions to ensure correct results. As described earlier, the EG is built using the legacy dirty-propagation mechanism. Therefore, optimizations used to limit dirty propagation during DG evaluation, such as those found in <code>MPxNode::setDependentsDirty</code>, may introduce errors in the EG. Use <strong><a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_evaluation_manager_html#aedb4df14a76f10672127a768071670f5">MEvaluationManager::graphConstructionActive()</a></strong> to detect if this is occurring.</p>
<p>There are new virtual methods you will want to consider implementing:</p>
<ul>
<li>
<p><strong><code>MPxNode::preEvaluation</code>.</strong> To avoid performing expensive calculations each time the evaluation method <code>MPxNode::compute()</code> is called, one strategy plug-in authors use is to store results from previous evaluations and then rely on <code>MPxNode::setDependentsDirty</code> to trigger re-computation. As discussed previously, once the EG has been built, dirty propagation is disabled and the EG is re-used. Threrefore, any custom logic in your plug-in that depends on setDependentsDirty no longer applies.  </p>
<p><code>MPxNode::preEvaluation</code> allows your plug-in to determine which plugs/attributes are dirty and if any action is needed. Use the new MEvaluationNode class to determine what has been dirtied.  </p>
<p>Refer to the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_simple_evaluation_node_2simple_evaluation_node_8cpp_example_html">simpleEvaluationNode</a> devkit example for an illustration of how to use <code>MPxNode::preEvaluation</code>.</p>
</li>
<li>
<p><strong><code>MPxNode::postEvaluation</code>.</strong> Until now, it was difficult to determine at which point all processing for a node instance was complete. Users sometimes resorted to complex bookkeeping/callback schemes to detect this situation and perform additional work, such as custom rendering. This mechanism was cumbersome and error-prone.  </p>
<p>Once all computations have been performed on a specific node instance, a new method, <code>MPxNode::postEvaluation</code>, is called. Since this method is called from a worker thread, it performs calculations for downstream graph operations without blocking other Maya processing tasks of non-dependent nodes.  </p>
<p>See the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_simple_evaluation_draw_2simple_evaluation_draw_8cpp_example_html">simpleEvaluationDraw</a> devkit example to understand how to use this method. If you run this example in regular evaluation, Maya slows down, since evaluation is blocked whenever expensive calculations are performed. When you run in Parallel Evaluation Mode, a worker thread calls the postEvaluation method and prepares data for subsequent drawing operations. When testing, you will see higher frame rates in Parallel evaluation versus regular or Serial evaluation. Please note that code in postEvaluation should be thread-safe.</p>
</li>
</ul>
<p>Other recommended best practices include:</p>
<ul>
<li>
<p><strong>Avoid storing state in static variables.</strong> Store node state/settings in attributes. This has the additional benefit of automatically saving/restoring the plug-in state when Maya files are written/read.</p>
</li>
<li>
<p><strong>Node computation should not have any dependencies beyond input values.</strong> Maya nodes should be like functions. Output values should be computed from input state and node-specific internal logic. Your node should never walk the graph or try to circumvent the DG.</p>
</li>
</ul>
<h4 id="custom-gpu-deformers">Custom GPU Deformers</h4>
<p>To make GPU Override work on scenes containing custom deformers, Maya provides new API classes that allow the creation of fast <a href="https://www.khronos.org/opencl/">OpenCL</a> deformer back-ends.</p>
<p>Though you still need to have a CPU implementation for the times when it is not possible to target deformations on the GPU (see <a href="#gpu-override">GPU Override</a>), you can augment this with an alternate deformer implementation inheriting from <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_px_g_p_u_deformer_html">MPxGPUDeformer</a>. This applies to your own nodes as well as to standard Maya nodes.</p>
<p>The GPU implementation will need to:</p>
<ul>
<li>Declare when it is valid to use the GPU-based backend (for example, you may want to limit you GPU version to cases where various attributes are fixed, omit usage for specific attribute values, and so on)</li>
<li>Extract MDataBlock input values and upload values to the GPU</li>
<li>Define and call the OpenCL kernel to perform needed computation</li>
<li>Register itself with the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_g_p_u_deformer_registry_html">MGPUDeformerRegistry</a> system. This will tell the system which deformers you are claiming responsibility for.</li>
</ul>
<p>When you have done this, do not forget to load your plug-in at startup. Two working devkit examples (<a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_offset_node_2offset_node_8cpp_example_html">offsetNode</a> and <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_identity_node_2identity_node_8cpp_example_html">identityNode</a>) have been provided to get you started.</p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>To get a sense for the maximum speed increase you can expect by providing a GPU backend for a specific deformer, tell Maya to treat specific nodes as passthrough. Heres an example applied to polySoftEdge:</p>
</div>
<blockquote>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>   cmds.GPUBuiltInDeformerControl(
       name=&quot;polySoftEdge&quot;,
       inputAttribute=&quot;inputPolymesh&quot;,
       outputAttribute=&quot;output&quot;,
       passthrough=True
       )
</code></pre></div>

<p>Although results will be incorrect, this test will confirm if it is worth investing time implementing an OpenCL version of your node.</p>
</blockquote>
<h4 id="custom-evaluator-api">Custom Evaluator API</h4>
<p>API classes and methods introduced in Maya 2017 let you define custom evaluators that allow control over how the Maya scene is computed.</p>
<p>To create a custom evaluator, you must define a plug-in that extends the <code>MPxCustomEvaluator</code> class. The key class methods to override are described below.</p>
<h3 id="the-basics">The Basics</h3>
<p>Before you can use the new evaluators, they must be registered:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>MStatus registerEvaluator(
    // name of the evaluator
    const char *     evaluatorName,

    // evaluator priority. Higher priority evaluators get &#39;first-dibs&#39;
    unsigned int     uniquePriority,

    // function pointer to method returning a new evaluator instance
    MCreatorFunction creatorFunction
)
</code></pre></div>

<p>and deregistered:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>MStatus deregisterEvaluator(
    // name of the evaluator
    const char* evaluatorName
)
</code></pre></div>

<p>using <code>MFnPlugin</code> methods. These functions should be used during plug-in initialization:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>MStatus initializePlugin( MObject obj )
{
    MFnPlugin plugin( obj, PLUGIN_COMPANY, &quot;3.0&quot;, &quot;Any&quot;);
    MStatus status = plugin.registerEvaluator(
        &quot;SimpleEvaluator&quot;,
        40,
        simpleEvaluator::creator);
    if (!status)
        status.perror(&quot;registerEvaluator&quot;);
    return status;
}
</code></pre></div>

<p>and uninitialization:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>MStatus uninitializePlugin( MObject obj )
{
    MFnPlugin plugin( obj );
    MStatus status = plugin.deregisterEvaluator( &quot;SimpleEvaluator&quot; );
    if (!status)
        status.perror(&quot;deregisterEvaluator&quot;);
    return status;
}
</code></pre></div>

<p>as illustrated above.</p>
<p>Once the plug-in has been loaded, use Python or MEL commands to <strong>enable</strong>:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>import maya.cmds as cmds
cmds.evaluator(enable=True, name=&#39;SimpleEvaluator&#39;)

# Result: False #
</code></pre></div>

<p><strong>disable</strong>:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>cmds.evaluator(enable=False, name=&#39;SimpleEvaluator&#39;)

# Result: True #
</code></pre></div>

<p>and <strong>query</strong> information about evaluators:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>print cmds.evaluator(query=True)

[u&#39;invisibility&#39;, ... u&#39;SimpleEvaluator&#39;]
</code></pre></div>

<blockquote>
<p><strong>NOTE:</strong> The evaluator command returns the previous state of the evaluator (as described in the documentation). This command fails if the evaluator cannot be enabled.</p>
</blockquote>
<p>To view the priorities of all loaded evaluators, use the priority flag on the evaluator command:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>for evaluatorName in cmds.evaluator():
    print &quot;%-25s : %d&quot; % (
        evaluatorName,
        cmds.evaluator(name=evaluatorName, query=True, priority=True))

invisibility              : 1003000
frozen                    : 1002000
curveManager              : 1001000
cache                     : 1000000
timeEditorCurveEvaluator  : 104000
dynamics                  : 103000
ikSystem                  : 102000
disabling                 : 100000
hik                       : 7000
reference                 : 6000
deformer                  : 5000
cycle                     : 4000
transformFlattening       : 3000
pruneRoots                : 1000
SimpleEvaluator           : 40
</code></pre></div>

<h3 id="api-reference">API Reference</h3>
<p>This section provides more detail on different <code>MPxCustomEvaluator</code> API methods.</p>
<h4 id="claiming-clusters">Claiming clusters</h4>
<p>During EG partitioning, each evaluator gets to claim evaluation nodes, using the:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>bool MPxCustomEvaluator::markIfSupported(const MEvaluationNode* node)
</code></pre></div>

<p>method. You can safely cause evaluation in this call but doing so increases partitioning and evaluation time. The developer can decide whether evaluation is required (call <code>.inputValue</code> / <code>.inputArrayValue</code>), or the previously-evaluated datablock values can be re-used (call <code>.outputValue</code> / <code>.outputArrayValue</code>). If multiple evaluators mark a specific node, which evaluator is assigned a node at run-time is determined by priority. For example, if you have two evaluators, A and B, mark node C of interest, if evaluator A has priority 100, and evaluator B has priority 10, during graph partitioning, evaluator A will get the opportunity to grab node C before evaluator B. Evaluators should not try to grab a node already grabbed by a higher-priority evaluator.</p>
<h4 id="scheduling">Scheduling</h4>
<p>To determine if an evaluator can evaluate clusters in Parallel, use:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>MCustomEvaluatorClusterNode::SchedulingType schedulingType(
    // a disjoint set of nodes on a custom evaluator layer
    const MCustomEvaluatorClusterNode * cluster
)
</code></pre></div>

<p>where:</p>
<p><strong>SchedulingType</strong></p>
<p><strong>Details</strong></p>
<p><strong>kParallel</strong></p>
<p>any number of nodes of the same type can run in parallel</p>
<p><strong>kSerial</strong></p>
<p>all nodes of this type should be chained and executed sequentially</p>
<p><strong>kGloballySerial</strong></p>
<p>only one node of this type can be run at a time</p>
<p><strong>kUntrusted</strong></p>
<p>nothing else can execute with this node since we cannot predict what will happen</p>
<p>During EG scheduling:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>bool MPxCustomEvaluator::clusterInitialize(
    // evaluation cluster node
    const MCustomEvaluatorClusterNode* cluster
)
</code></pre></div>

<p>can be used to perform the required cluster preparation. The pointer to the cluster remains valid until graph invalidation, such as when the scene topology changes.</p>
<p>Before the cluster is deleted,</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void MPxCustomEvaluator::clusterTerminate(
    // the cluster to terminate
    const MCustomEvaluatorClusterNode* cluster
)
</code></pre></div>

<p>is called to allow needed cleanup, for example, releasing evaluator-specific resources. It is up to the custom evaluator to decide if it wants to clear its internal representation.</p>
<h4 id="execution">Execution</h4>
<p>There are 3 main methods used during execution.</p>
<p>Prior to graph execution, the EM calls:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void MPxCustomEvaluator::preEvaluate(
    // the graph about to be evaluated
    const MEvaluationGraph* graph
)
</code></pre></div>

<p>during execution, the EM calls:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void MPxCustomEvaluator::clusterEvaluate(
    // the cluster to be evaluated
    const MCustomEvaluatorClusterNode* cluster
)
</code></pre></div>

<p>You will only receive clusters that belong to this evaluator. This call always happens after <code>clusterInitialize</code> and never after <code>clusterTerminate</code>. Finally,</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void MPxCustomEvaluator::postEvaluate(
    // the graph that was evaluated
    const MEvaluationGraph* graph
)
</code></pre></div>

<p>is called just after a graph evaluation is finished.</p>
<h3 id="simpleevaluator-api-example">SimpleEvaluator API Example</h3>
<p>Now that we have reviewed relevant API methods, the following example limits evaluation by caching previous results. <code>simpleEvaluator</code> assumes the existence of scene nodes that tag controller nodes with animation and works as follows:</p>
<p>In <code>clusterInitialize</code>, we-2"&gt;ld a list of translation and rotation attribute plugs.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>// Build a list of plugs by scanning the scene for controller nodes.
// This gets called during scheduling.
bool simpleEvaluator::clusterInitialize(
    const MCustomEvaluatorClusterNode* cluster
    )
{
    if (fControllerPlugs.length() == 0)
        buildPlugListWithControllerTag();
    return true;
}

// Scan the scene for any controller nodes, populating the plug list.
// Called during the scheduling phase
void simpleEvaluator::buildPlugListWithControllerTag()
{
    MStatus stat;
    MItDependencyNodes dgIter(MFn::kControllerTag, &amp;stat);
    if (stat != MS::kSuccess)
        return;

    const char* values[] = {
        &quot;translateX&quot;,
        &quot;translateY&quot;,
        &quot;translateZ&quot;,
        &quot;rotateX&quot;,
        &quot;rotateY&quot;,
        &quot;rotateZ&quot;
    };

    for (; !dgIter.isDone(); dgIter.next())
    {
        MFnDependencyNode controllerTagNode(dgIter.thisNode(), &amp;stat);
        if (stat != MS::kSuccess)
            continue;

        MPlug currControllerTagPlug =
            controllerTagNode.findPlug(&quot;controllerObject&quot;, &amp;stat);
        if (stat != MS::kSuccess)
            continue;

        // found controller tag node, now get its source controller
        MPlugArray source;
        bool retval = currControllerTagPlug.connectedTo(
            source,
            true /* asDst */,
            false /* asSrc */,
            &amp;stat)
        if ((retval == false) || (stat != MS::kSuccess))
            continue;

        // there should only be one source with the controller tag node
        // as destination
        MObject controllerNode = source[0].node(&amp;stat);
        if (stat != MS::kSuccess)
            continue;

        MFnDependencyNode currControllerNode(controllerNode, &amp;stat);
        if (stat != MS::kSuccess)
            continue;

        for (unsigned int j = 0; j &lt; 6; j++)
        {
            MPlug currPlug = currControllerNode.findPlug(values[j], &amp;stat);
            if (stat == MS::kSuccess)
                fControllerPlugs.append(currPlug);
            else
                std::cerr
                    &lt;&lt; &quot;NO PLUG: &quot;
                    &lt;&lt; currControllerNode.name().asChar()
                    &lt;&lt; &quot;.&quot;
                    &lt;&lt; values[j]
                    &lt;&lt; std::endl;
        }
    }
}
</code></pre></div>

<p>Later, during <code>preEvaluate</code>, which is called per-frame, a hash value is calculated based on the plug values of the current frame.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void simpleEvaluator::preEvaluate(const MEvaluationGraph* graph)
{
    buildHashValue();
}

void simpleEvaluator::buildHashValue()
{
    unsigned int length = fControllerPlugs.length();
    MStatus stat = MS::kSuccess;

    for (unsigned int i = 0; i &lt; length; i++)
    {
        float value = 0;
        stat = fControllerPlugs[i].getValue(value);

        if (stat == MS::kSuccess)
        {
            boost::hash_combine(fCurrentHashValue, value);
        }
        else
        {
            std::cerr
                &lt;&lt; &quot;NO VALUE: &quot;
                &lt;&lt; fControllerPlugs[i].name().asChar()
                &lt;&lt; std::endl;
        }
    }
}
</code></pre></div>

<p>This value is compared with the previous frames hash in <code>clusterEvaluate</code>. If the hash is different, the evaluation proceeds, otherwise we do nothing.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void simpleEvaluator::clusterEvaluate(
    const MCustomEvaluatorClusterNode* cluster
    )
{
    if (fOldHashValue != fCurrentHashValue)
        cluster-&gt;evaluate();
}
</code></pre></div>

<p>To make sure the hash value is up-to-date, the hash value is stored in <code>postEvaluate</code>.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void simpleEvaluator::postEvaluate(const MEvaluationGraph* graph)
{
    fOldHashValue = fCurrentHashValue;
    fCurrentHashValue = 0;
}
</code></pre></div>

<p>Finally, when the graph topology becomes invalid, we call <code>clusterTerminate</code> to clear the cached list of plugs.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>void simpleEvaluator::clusterTerminate(
    const MCustomEvaluatorClusterNode* cluster
    )
{
    if (fControllerPlugs.length() &gt; 0)
        fControllerPlugs.clear();
}
</code></pre></div>

<p>Since <code>simpleEvaluator</code> claims control over the entire graph, <code>markIfSupported</code> returns true for all nodes. Additionally, nothing special is done to alter the clusters scheduling behavior.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>bool simpleEvaluator::markIfSupported(const MEvaluationNode* node)
{
    return true;
}

MCustomEvaluatorClusterNode::SchedulingType
simpleEvaluator::schedulingType(const MCustomEvaluatorClusterNode* cluster)
{
    return cluster-&gt;schedulingType();
}
</code></pre></div>

<p>See the provided <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_simple_evaluator_2simple_evaluator_8cpp_example_html">simpleEvaluator</a> devkit example for more details and complete source code.</p>
<h4 id="vp2-integration">VP2 Integration</h4>
<p>Evaluation Manager Parallel Evaluation executes the Dependency Graph in parallel. Internally, Maya nodes begin preparing render data for VP2 immediately after a node is evaluated, and before the rest of the graph has finished evaluation. This is exposed to users as Evaluation Manager Parallel Update in the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_px_geometry_override_html">MPxGeometryOverride</a> API (this feature may also be referred to as Direct Update). Supporting Evaluation Manager Parallel Update can significantly reduce time spent in Vp2BuildRenderLists and improve overall scene performance.</p>
<p>The following profiler images were created from the same scene (100 <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_foot_print_node_geometry_override_2foot_print_node_geometry_override_8cpp_example_html">footPrintNode_GeometryOverride</a> nodes with animated size attributes). In the first image Evaluation Manager Parallel Update is not enabled, and a large amount of time is spent serially preparing draw data for each footPrint node in Vp2BuildRenderLists.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167581-7f660e7c-b627-4f29-a9ec-9a4e2cd83f3e.png" /></p>
<p>In the second image the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_foot_print_node_geometry_override_2foot_print_node_geometry_override_8cpp_example_html">footPrintNode_GeometryOverride</a> has been modified to support Evaluation Manager Parallel Update. You can see that the long serial execution time in Vp2BuildRenderLists has been eliminated. All the data marshalling for VP2 is occurring in parallel while the Evaluation Manager is evaluating the Dependency Graph.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167586-d5c40de0-7bd5-4de8-b0f7-bfba3d246449.png" /></p>
<p>The <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_foot_print_node_geometry_override_2foot_print_node_geometry_override_8cpp_example_html">footPrintNode_GeometryOverride</a> example plug-in provides a detailed example for you to create an efficient <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_px_geometry_override_html">MPxGeometryOverride</a> plugin which supports Evaluation Manager Parallel Update and gives excellent performance in VP2.</p>
<p>Supporting Evaluation Manager Direct Update adds some restrictions to which operations can safely be performed from <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_px_geometry_override_html">MPxGeometryOverride</a> function calls. All <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_px_geometry_override_html">MPxGeometryOverride</a> functions (except cleanUp() and the destructor) may be called from a worker thread in parallel with other Maya execution. These methods must all be thread safe. An <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_px_geometry_override_html">MPxGeometryOverride</a> object is guaranteed to have at most one of its member functions called at a time. If two different <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_px_geometry_override_html">MPxGeometryOverride</a> objects A and B both require updating, then any member function on A could be called at the same time as any member function on B.</p>
<p>Furthermore, because these methods may be called from a worker thread, direct access to the rendering context is prohibited. <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_vertex_buffer_html">MVertexBuffer</a> and <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_index_buffer_html">MIndexBuffer</a> can still be used, but some of their features are prohibited from use when in Evaluation Manager Parallel Update. Details about which features are safe to use are provided in the documentation for <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_vertex_buffer_html">MVertexBuffer</a> and <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_h_w_render_1_1_m_index_buffer_html">MIndexBuffer</a>.</p>
<h4 id="tracking-topology">Tracking Topology</h4>
<p>Evaluation Manager Parallel Update currently has the limitation that it can only be used on geometries that do not have animated topology. The status of whether topology is animated or not needs to be tracked from the geometrys origin to its display shape.</p>
<p>If the nodes in the graph are built-in nodes, Maya can know if an animated input will affect the output geometry topology. Similarly, deformers (even custom ones derived from <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_px_deformer_node_html">MPxDeformerNode</a>), are assumed to simply deform their input in their output, keeping the same topology.</p>
<p>However, more generic nodes can also generate geometries. When a custom node is a <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_px_node_html">MPxNode</a>, Maya cannot know whether an output geometry has animated topology. It therefore assumes the worst and treats the topology as animated. While this approach is the safest, it can prevent optimizations such as Evaluation Manager Parallel Update.</p>
<p>As of Maya 2019, a new API has been added to inform Maya about attributes that might <strong>not</strong> affect the topology of an output geometry.</p>
<ul>
<li>The first step is to override the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_px_node_html#a9e054d22b4addd21d5b92c969a7a1ee6"><strong>MPxNode::isTrackingTopology()</strong></a> method so that Maya can track topology information for this node.</li>
<li>The second step is the use the new version of the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=Maya_SDK_MERGED_cpp_ref_class_m_px_node_html#a214deb1c971a5879657c8b1de4156422"><strong>MPxNode::attributeAffects()</strong></a> method to inform Maya that while the source attribute affects the output attribute, it does <strong>not</strong> affect its topology.</li>
</ul>
<p>Using this new API helps Maya to know that it is safe to use Evaluation Manager Parallel Update and benefit from its performance boost in more situations.</p>
<h4 id="profiling-plug-ins">Profiling Plug-ins</h4>
<p>To visualize how long custom plug-ins take in the new profiling tools (see <a href="#profiling-your-scene">Profiling Your Scene</a>) you will need to instrument your code. Maya provides C++, Python, and MEL interfaces for you to do this. Refer to the <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=GUID-3723226B-8A46-41A4-9FB4-AF5B55DF72A2">Profiling using MEL or Python or the API</a> technical docs for more details.</p>
<h3 id="profiling-your-scene">Profiling Your Scene</h3>
<p>In the past, it could be challenging to understand where Maya was spending time. To remove the guess-work out of performance diagnosis, Maya includes a new integrated <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=GUID-3423BE20-0F03-422D-A05A-A1757C7B0A70">profiler</a> that lets you see exactly how long different tasks are taking.</p>
<p>Open the Profiler by selecting:</p>
<ul>
<li><strong>Windows &gt; General Editors &gt; Profiler</strong> from the Maya menu</li>
<li><strong>Persp/Graph Layout</strong> from the Quick Layout buttons and choosing <strong>Panel Layout &gt; Profiler</strong><em>.</em></li>
</ul>
<p>Once the Profiler window is visible:</p>
<ol>
<li>Load your scene and start playback</li>
<li>Click <strong>Start</strong> in the Profiler to record information in the pre-allocated record buffer.</li>
<li>Wait until the record buffer becomes full or click <strong>Stop</strong> in the Profiler to stop recording. The Profiler shows a graph demonstrating the processing time for your animation.</li>
<li>Try recording the scene in <strong>DG</strong>, <strong>Serial</strong>, <strong>Parallel</strong>, and <strong>GPU</strong> <strong>Override</strong> modes.</li>
</ol>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>By default, the Profiler allocates a 20MB buffer to store results. The record buffer can be expanded in the UI or by using the <code>profiler -b value;</code> command, where <em>value</em> is the desired size in MB. You may need this for more complex scenes.</p>
</div>
<p>The Profiler includes information for all instrumented code, including playback, manipulation, authoring tasks, and UI/Qt events. When profiling your scene, make sure to capture several frames of data to ensure gathered results are representative of scene bottlenecks.</p>
<p>The Profiler supports several views depending on the task you wish to perform. The default <strong>Category View</strong>, shown below, classifies events by type (e.g., dirty, VP1, VP2, Evaluation, etc). The <strong>Thread</strong> and <strong>CPU</strong> views show how function chains are subdivided amongst available compute resources. Currently the Profiler does not support visualization of GPU-based activity.</p>
<p>![][image1.jpg]</p>
<h4 id="understanding-your-profile">Understanding Your Profile</h4>
<p>Now that you have a general sense of what the Profiler tool does, lets discuss key phases involved in computing results for your scene and how these are displayed. By understanding why scenes are slow, you can target scene optimizations.</p>
<p>Every time Maya updates a frame, it must compute and draw the elements in your scene. Hence, computation can be split into one of two main categories:</p>
<ol>
<li>Evaluation (i.e., doing the math that determines the most up-to-date values for scene elements)</li>
<li>Rendering (i.e., doing the work that draws your scene in the viewport).</li>
</ol>
<p>When the main bottleneck in your scene is evaluation, we say the scene is <strong>evaluation-bound</strong>. When the main bottleneck in your scene is rendering, we say the scene is <strong>render-bound</strong>.</p>
<h4 id="profiler-colors">Profiler Colors</h4>
<p>Each event recorded by the profiler has an associated color. Each color represents a different type of event. By understanding event colors you can quickly interpret profiler results. Some colors are re-used and so have different meanings in different categories.</p>
<ul>
<li>Dirty Propagation (Pink and Purple)</li>
<li>Pull Evaluation (Dark Green)</li>
<li>Forward or Evaluation Manager Evaluation (Peach, Tan and Brown)</li>
<li>Set Time (Light Green)</li>
<li>Qt Events (Light Blue)</li>
<li>VP2 Rendering (Light Blue)</li>
<li>VP2 Pull Updates (Light and Dark Yellow and Blue)</li>
<li>VP2 Push or Direct Updates (Light and Dark Blue)</li>
<li>GPU Override CPU usage (Light and Dark Yellow)</li>
<li>Cache Restore (Yellow)</li>
<li>Cache Skipped (Gray)</li>
</ul>
<p>We cant see every different type of event in a single profile, because some events like Dirty Propagation only occur with Evaluation Manager off, and other events like GPU Override CPU usage only occur with Evaluation Manager on. In the following example profiles we will show DG Evaluation, Evaluation Manager Parallel Evaluation, GPU Override Evaluation, Evaluation Cached Evaluation and VP2 Cached Evaluation.<br />
Through these examples well see how to interpret a profile based on graph colors and categories, and well learn how each performance optimization in Maya can impact a scenes performance. The following example profiles are all generated from the same simple FK character playing back.</p>
<h4 id="dg-evaluation">DG Evaluation</h4>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167588-21d6727c-c840-44d4-b901-ced62696fd01.png" /></p>
<p>In this profile of DG Evaluation we can see several types of event.</p>
<ol>
<li>Pink and purple Dirty Propagation events in the Dirty Propagation category.</li>
<li>Dark green Pull Evaluation events in the Evaluation category.</li>
<li>Blue VP2 Pull Translation and light blue VP2 Rendering in the VP2 Evaluation category.</li>
<li>Yellow events in the VP2 Evaluation category show time VP2 spent waiting for data from Dependency Graph nodes.</li>
</ol>
<p>A significant fraction of each frame is spent on Dirty Propagation, a problem which is alleviated by Evaluation Manager.</p>
<h4 id="em-parallel-evaluation">EM Parallel Evaluation</h4>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167589-e5a328a7-b246-4243-9581-0f82bacf6749.png" /></p>
<p>In this profile of EM Parallel Evaluation we can see all the purple and pink dirty propagation is gone.</p>
<ol>
<li>Peach, tan and brown EM Parallel Evaluation events of the FK rig colored. The high stack of events represents some evaluation occurring in parallel (use thread view to better understand parallelism).</li>
<li>Tan and brown EM Parallel Evaluation events while Maya evaluates the skin cluster to compute the deformed mesh. These events occur serially because the Dependency Graph has no parallelism.</li>
<li>Dark blue and blue VP2 Direct Update events translate data into a VP2 render-able format.</li>
<li>Yellow in the Main category and light blue in the VP2 Evaluation category are VP2 Rendering events.</li>
</ol>
<p>In this profile we see much less time spent on Vp2SceneRender (4). This occurs because time spent reading data from dependency nodes has been moved from rendering to EM Parallel Evaluation (1). DG evaluation uses a data pull model, while EM Evaluation uses a data push model. Additionally, some geometry translation (2), is also moved from rendering to evaluation. We call geometry translation during evaluation VP2 Direct Update. A significant portion of each frame is spent deforming and translating the geometry data, a problem which is alleviated by GPU Override.</p>
<h4 id="em-parallel-evaluation-with-gpu-override">EM Parallel Evaluation with GPU Override</h4>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167591-50d36f32-df6c-4277-883a-9045f1e9d147.png" /></p>
<p>In this profile of EM Parallel Evaluation we can see one major new difference from the previous profile of EM Parallel Evaluation.</p>
<ol>
<li>Light and dark yellow GPU Override events have replaced the long serial central part of the EM Parallel Evaluation profile (2 &amp; 3 from EM Parallel Evaluation). The GPU Override events represent the time taken on the CPU to marshal data and launch the GPU computation.</li>
<li>Peach, tan and brown EM Parallel Evaluation events here have roughly the same duration as EM Parallel Evaluation even though the relative size of the rig evaluation events with GPU Override is larger. This is because the scale of this profile is different from the scale of the previous profile. In the profile of EM Parallel Evaluation with GPU Override the total time displayed is about 5ms. In the previous profile of EM Parallel Evaluation the total time displayed is about 12ms.</li>
<li>Light blue VP2 Render events have experienced a similar relative stretching (2).</li>
</ol>
<h4 id="em-evaluation-cached-playback">EM Evaluation Cached Playback</h4>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167592-9842ae12-c995-48f9-b196-0e5116ae9bdb.png" /></p>
<p>In this profile of EM Evaluation Cached Playback we can see several new types of event.</p>
<ol>
<li>Yellow Restore Cache events recording the time taken to update each FK rig node which has cached data. There are also brown VP2 Direct Update events used to track update of the VP2 representation of the data.</li>
<li>Yellow Restore Cache event for the deformed mesh. This represents the time taken to restore the data into the Maya node, and to translate the data into VP2 for drawing using VP2 Direct Update.</li>
</ol>
<h4 id="em-vp2-hardware-cached-playback">EM VP2 Hardware Cached Playback</h4>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167594-37a3f0c1-f257-4214-889e-cc7d48fe62a7.png" /></p>
<ol>
<li>Dark blue VP2 Hardware Cache Restore events have replaced the long serial Cache Restore event (2 from EM Evaluation Cached Playback). Restoring the VP2 Hardware Cache is much faster because the data is already in in the render-able format and stored on the GPU.</li>
<li>Gray Cache Skipped event signaling data in the dependency node is not updated.</li>
</ol>
<h4 id="evaluation-bound-performance">Evaluation-Bound Performance</h4>
<p>When the main bottleneck in your scene is evaluation, we say the scene is <strong>evaluation-bound</strong>. There are several different problems that may lead to evaluation-bound performance.</p>
<p><strong>Lock Contention.</strong> When many threads try to access a shared resource you may experience Lock Contention, due to lock management overhead. One clue that this may be happening is that evaluation takes roughly the same duration regardless of which evaluation mode you use. This occurs since threads cannot proceed until other threads are finished using the shared resource.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167567-6c3f93dc-4232-416b-8e0c-ee4be8f52b95.png" /></p>
<p>Here the Profiler shows many separate identical tasks that start at nearly the same time on different threads, each finishing at different times. This type of profile offers a clue that there might be some shared resource that many threads need to access simultaneously.</p>
<p>Below is another image showing a similar problem.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167568-cf8e6f44-ee4f-4590-8825-211bb1c81e84.png" /></p>
<p>In this case, since several threads were executing Python code, they all had to wait for the Global Interpreter Lock (GIL) to become available. Bottlenecks and performance loses caused by contention issues may be more noticeable when there is a high concurrency level, such as when your computer has many cores.</p>
<p>If you encounter contention issues, try to fix the code in question. For the above example, changing node scheduling converted the above profile to the following one, providing a nice performance gain. For this reason, Python plug-ins are scheduled as Globally Serial by default. As a result, they will be scheduled one after the other and will not block multiple threads waiting for the GIL to become available.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167570-5e52ac2f-0db3-4469-a3fa-4efe7b4c1606.png" /></p>
<p><strong>Clusters.</strong> As mentioned earlier, if the EG contains node-level circular dependencies, those nodes will be grouped into a <strong>cluster</strong> which represents a single unit of work to be scheduled serially. Although multiple clusters may be evaluated at the same time, large clusters limit the amount of work that can be performed simultaneously. Clusters can be identified in the Profiler as bars wiip.opaqueTaskEvaluation label, shown below.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167571-d5af5c2a-a674-439b-9806-c4ee3a8a5201.png" /></p>
<p>If your scene contains clusters, analyze your rigs structure to understand why circularities exist. Ideally, you should strive to remove coupling between parts of your rig, so rig sections (e.g., head, body, etc.) can be evaluated independently.</p>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>When troubleshooting scene performance issues, you can temporarily disable costly nodes using the per-node <code>frozen</code> attribute. This removes specific nodes from the EG. Although the result you see will change, it is a simple way to check that you have found the bottleneck for your scene.</p>
</div>
<h4 id="render-bound-performance">Render-Bound Performance</h4>
<p>When the main bottleneck in your scene is rendering, we say the scene is <strong>render-bound</strong>. The following is an illustration of a sample result from the Maya Profiler, zoomed to a single frame measured from a large scene with many animated meshes. Because of the number of objects, different materials, and the amount of geometry, this scene is very costly to render.</p>
<p>![][image6.jpeg]</p>
<p>The attached profile has four main areas:</p>
<ul>
<li>Evaluation (A)</li>
<li>GPUOverridePostEval (B)</li>
<li>Vp2BuildRenderLists (C)</li>
<li>Vp2Draw3dBeautyPass (D)</li>
</ul>
<p>In this scene, a substantial number of meshes are being evaluated with GPU Override and some profiler blocks appear differently from what they would otherwise.</p>
<p><strong>Evaluation.</strong> Area A depicts the time spent computing the state of the Maya scene. In this case, the scene is moderately well-parallelized. The blocks in shades of orange and green represent the software evaluation of DG nodes. The blocks in yellow are the tasks that initiate mesh evaluation via GPU Override. Mesh evaluation on the GPU starts with these yellow blocks and continues concurrently with the other work on the CPU.</p>
<p>An example of a parallel bottleneck in the scene evaluation appears in the gap in the center of the evaluation section. The large group of GPU Override blocks on the right depend on a single portion of the scene and must wait until that is complete.</p>
<p>Area A2 (above area A), depicts blue task blocks that show the work that VP2 does in parallel to the scene evaluation. In this scene, most of the mesh work is handled by GPU Override so it is mostly empty. When evaluating software meshes, this section shows the preparation of geometry buffers for rendering.</p>
<p><strong>GPUOverridePostEval.</strong> Area B is where GPU Override finalizes some of its work. The amount of time spent in this block varies with different GPU and driver combinations. At some point there will be a wait for the GPU to complete its evaluation if it is heavily loaded. This time may appear here or it may show as additional time spent in the Vp2BuildRenderLists section.</p>
<p><strong>Vp2BuildRenderLists.</strong> Area C. Once the scene has been evaluated, VP2 builds the list of objects to render. Time in this section is typically proportional to the number of objects in the scene.</p>
<p><strong>Vp2PrepareToUpdate.</strong> Area C2, very small in this profile. VP2 maintains an internal copy of the world and uses it to determine what to draw in the viewport. When it is time to render the scene, we must ensure that the objects in the VP2 database have been modified to reflect changes in the Maya scene. For example, objects may have become visible or hidden, their position or their topology may have changed, and so on. This is done by VP2 Vp2PrepareToUpdate.</p>
<p>Vp2PrepareToUpdate is slow when there are shape topology, material, or object visibility changes. In this example, Vp2PrepareToUpdate is almost invisible since the scene objects require little extra processing.</p>
<p>Vp2ParallelEvaluationTask is another profiler block that can appear in this area. If time is spent here, then some object evaluation has been deferred from the main evaluation section of the Evaluation Manager (area A) to be evaluated later. Evaluation in this section uses traditional DG evaluation.</p>
<p>Common cases for which Vp2BuildRenderLists or Vp2PrepareToUpdate can be slow during Parallel Evaluation are:</p>
<ul>
<li>Large numbers of rendered objects (as in this example)</li>
<li>Mesh topology changes</li>
<li>Object types, such as image planes, requiring legacy evaluation before rendering</li>
<li>3<sup>rd</sup> party plug-ins that trigger API callbacks</li>
</ul>
<p><strong>Vp2Draw3dBeautyPass.</strong> Area D. Once all data has been prepared, it is time to render the scene. This is where the actual OpenGL or DirectX rendering occurs. This area is broken into subsections depending on viewport effects such as depth peeling, transparency mode, and screen space anti-aliasing.</p>
<p>Vp2Draw3dBeautyPass can be slow if your scene:</p>
<ul>
<li><strong>Has Many Objects to Render</strong> (as in this example).</li>
<li><strong>Uses Transparency</strong>. Large numbers of transparent objects can be costly since the default transparency algorithm makes scene consolidation less effective. For very large numbers of transparent objects, setting Transparency Algorithm (in the vp2 settings) to Depth Peeling instead of Object Sorting may be faster. Switching to untextured mode can also bypass this cost</li>
<li><strong>Uses Many Materials</strong>. In VP2, objects are sorted by material prior to rendering, so having many distinct materials makes this time-consuming.</li>
<li><strong>Uses Viewport Effects.</strong> Many effects such as SSAO (Screen Space Ambient Occlusion), Depth of Field, Motion Blur, Shadow Maps, or Depth Peeling require additional processing.</li>
</ul>
<p><strong>Other Considerations</strong>. Although the key phases described above apply to all scenes, your scene may have different performance characteristics.</p>
<p>For static scenes with limited animation, or for non-deforming animated objects, consolidation is used to improve performance. Consolidation groups objects that share the same material. This reduces time spent in both Vp2BuildRenderLists and Vp2Draw3dBeatyPass, since there are fewer objects to render.</p>
<h4 id="saving-and-restoring-profiles">Saving and Restoring Profiles</h4>
<p>Profile data can be saved at any time for later analysis using the <code>Edit -&gt; Save Recording...</code> or <code>Edit -&gt; Save Recording of Selected Events...</code> menu items in the Profiler window. Everything is saved as plain string data (see <a href="#profiler-file-format">the appendix describing the profiler file format</a> for a description of how it is stored) so that you can load profile data from any scene using the <code>Edit -&gt; Load Recording...</code> menu item without loading the scene that was profiled.</p>
<h3 id="troubleshooting-your-scene">Troubleshooting Your Scene</h3>
<h4 id="analysis-mode">Analysis Mode</h4>
<p>The purpose of Analysis Mode is to perform more rigorous inspection of your scene to catch evaluation errors. Since Analysis Mode introduces overhead to your scene, only use this during debugging activities; animators should not enable Analysis Mode during their day-to-day work. Note that Analysis Mode is not thread-safe, so it is limited to Serial; you cannot use analysis mode while in Parallel evaluation.</p>
<p>The key function of Analysis Mode is to:</p>
<ul>
<li><strong>Search for errors at each playback frame.</strong> This is different than Safe Mode, which only tries to identify problems at the start of parallel execution.</li>
<li><strong>Monitor read-access to node attributes.</strong> This ensures that nodes have a correct dependency structure in the EG.</li>
<li><strong>Return diagnostics to better understand which nodes influence evaluation.</strong> This is currently limited to reporting one destination node at a time.</li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Tip</p>
<p>To activate Analysis Mode, use the <code>dbtrace -k evalMgrGraphValid;</code> MEL command.</p>
</div>
<blockquote>
<p>Once active, error detection occurs after each evaluation. Missing dependencies are saved to a file in your machines temporary folder (e.g., <code>%TEMP%\_MayaEvaluationGraphValidation.txt</code> on Windows). The temporary directory on your platform can be determined using the <code>internalVar -utd;</code> MEL command.</p>
<p>To disable Analysis Mode, type: <code>dbtrace -k evalMgrGraphValid -off;</code></p>
</blockquote>
<p>Lets assume that your scene contains the following three nodes. Because of the dependencies, the evaluation manager must compute the state of nodes B and C prior to calculating the state of A.</p>
<p><img alt="" src="https://user-images.githubusercontent.com/2152766/132167579-0b9f96d5-98a2-452a-af7b-c784929919d4.png" /></p>
<p>Now lets assume Analysis Mode returns the following report:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Detected missing dependencies on frame 56
{
     A.output &lt;-x- B
     A.output &lt;-x- C [cluster]
}
Detected missing dependencies on frame 57
{
    A.output &lt;-x- B
    A.output &lt;-x- C [cluster]
}
</code></pre></div>

<p>The <code>&lt;-x-</code> symbol indicates the direction of the missing dependency. The <code>[cluster]</code> term indicates that the node is inside of a cycle cluster, which means that any nodes from the cycles could be responsible for attribute access outside of evaluation order</p>
<p>In the above example, B accesses the <code>output</code> attribute of A, which is incorrect. These types of dependency do not appear in the Evaluation Graph and could cause a crash when running an evaluation in Parallel mode.</p>
<p>There are multiple reasons that missing dependencies occur, and how you handle them depends on the cause of the problem. If Analysis Mode discovers errors in your scene from bad dependencies due to:</p>
<ul>
<li><strong>A user plug-in.</strong> Revisit your strategy for managing dirty propagation in your node. Make sure that any attempts to use clever dirty propagation dirty the same attributes every time. Avoid using different notification messages to trigger pulling on attributes for computation.</li>
<li><strong>A built-in node</strong>. You should communicate this information to us. This may highlight an error that we are unaware of. To help us best diagnose the causes of this bug, we would appreciate if you can provide us with the scene that caused the problem.</li>
</ul>
<h4 id="graph-execution-order">Graph Execution Order</h4>
<p>There are two primary methods of displaying the graph execution order.</p>
<p>The simplest is to use the compute trace object to acquire a recording of the computation order. This can only be used in Serial mode, as explained earlier. The goal of compute trace is to compare DG and EM evaluation results and discover any evaluation differences related to a different ordering or missing execution between these two modes.</p>
<p>Keep in mind that there will be many differences between runs since the EM executes the graph from the roots forward, whereas the DG uses values from the leaves. For example in the simple graph shown earlier, the EM guarantees that B and C will be evaluated before A, but provides no information about the relative ordering of B and C. However in the DG, A pulls on the inputs from B and C in a consistent order dictated by the implementation of node A. The EM could show either "B, C, A" or "C, B, A" as their evaluation order and although both might be valid, the user must decide if they are equivalent or not. This ordering of information can be even more useful when debugging issues in cycle computation since in both modes a pull evaluation occurs, which will make the ordering more consistent.</p>
<h4 id="the-evaluation-toolkit">The Evaluation Toolkit</h4>
<p>A set of debugging tools used to be shipped as a special shelf in Maya Bonus Tools, but they are now built-in within Maya. The Evaluation Toolkit provides features to query and analyze your scene and to activate / deactivate various modes. See the accompanying <a href="http://help.autodesk.com/view/MAYAUL/2020/ENU/?guid=GUID-E22B253D-914B-4056-93F5-755702A6C998">Evaluation Toolkit documentation</a> for a complete list of all helper features.</p>
<h3 id="known-limitations">Known Limitations</h3>
<p>This section lists known limitations for the new evaluation system.</p>
<ul>
<li><strong>VP2 Motion Blur will disable Parallel evaluation.</strong> For Motion Blur to work, the scene must be evaluated at different points in time. Currently the EM does not support this.</li>
<li><strong>Scenes using FBIK will revert to Serial.</strong> For several years now, Autodesk has been deprecating FBIK. We recommend using HIK for full-body retargeting/solving.</li>
<li><strong>dbtrace will not work in Parallel mode.</strong> As stated in the Analysis Mode section, the dbtrace command only works in Serial evaluation. Having traces enabled in Parallel mode will likely cause Maya to crash.</li>
<li><strong>The DG Profiler crashes in Parallel Mode.</strong> Unless you are in DG evaluation mode, you will be unable to use the legacy DG profiler. Time permitting, we expect to move features of the DG profiler into the new thread-safe integrated profiler.</li>
<li><strong>Batch rendering scenes with XGen may produce incorrect results.</strong></li>
<li><strong>Evaluation manager in both Serial and Parallel mode changes the way attributes are cached.</strong> This is done to allow safe parallel evaluation and prevent re-computation of the same data by multiple threads. This means that some scenes may evaluate differently if multiple computations of the same attribute occur in one evaluation cycle. With the Evaluation Manager, the first value will be cached.</li>
<li>VP2 Direct update does not work with polySoftEdge nodes.</li>
</ul>
<h3 id="appendices">Appendices</h3>
<h4 id="profiler-file-format">Profiler File Format</h4>
<p>The profiler stores its recording data in human-readable strings. The format is versioned so that older format files can still be read into newer versions of Maya (though not necessarily vice-versa).</p>
<p>This is a description of the version 1 format.</p>
<p>First, a content example:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>1     #File Version, # of events, # of CPUs
2     2\t12345\t8
3     Main\tDirty
4     #Comment mapping---------
5*    @27 = MainMayaEvaluation
6     #End comment mapping---------
7     #Event time, Comment, Extra comment, Category id, Duration, \
          Thread Duration, Thread id, Cpu id, Color id
8*    1234567\t@12\t@0\t2\t12345\t11123\t36\t1\t14
9     #Begin Event Tag Mapping---------
10    #Event ID, Event Tag
11*   123\tTaggy McTagface
12    #End Event Tag Mapping---------
13    #Begin Event Tag Color Mapping---------
14    #Tag Label, Tag Color
15*   Taggy\tMcTagface\t200\t200\t13
16    #End Event Tag Color Mapping---------
EOF
</code></pre></div>

<p>The following table describes the file format structure by referring to the previous content:</p>
<p>Line(s)</p>
<p>Description</p>
<p>1</p>
<p>A header line with general file information names</p>
<p>2</p>
<p>A tab-separated line containing the header information</p>
<p>3</p>
<p>A tab-separated line containing the list of categories used by the events (category ID is the index of the category in the list)</p>
<p>4</p>
<p>A header indicating the start of comment mapping (a mapping from an ID to the string it represents)</p>
<p>5*</p>
<p>Zero or more lines lines mapping a number onto a string in the form <code>@LINE = STRING</code>. The IDs do not correspond to anything outside of the file.</p>
<p>6</p>
<p>A footer indicating the end of comment mapping</p>
<p>7</p>
<p>A header indicating the start of event information. The names are the titles of the event columns.</p>
<ul>
<li>Event time is the absolute time, in ticks, the event started</li>
<li>Duration is the total amount of time, in ticks, for the entire event</li>
<li>Thread duration is the total amount of time, in ticks, the event took inside the thread</li>
<li>Comment and Extra comment use an ID from the comment mapping above</li>
<li>Category id is the index of the events category from the list at line 3</li>
<li>Cpu id and Thread id are the ones in which the event took place. Actual values are arbitrary; only meant to distinguish unique CPUs and Threads</li>
<li>Color id is an index into the color mapping internal to the app (colors at the time of creation are not stored in the file).</li>
</ul>
<p>8*</p>
<p>Zero or more tab-separated lines mapping to all of the events that were stored in the file</p>
<p>9</p>
<p>A header indicating the start of the event tag maps</p>
<p>10</p>
<p>A title line showing what values are in the event tag map columns</p>
<p>11*</p>
<p>Zero or more tab-separated lines attaching an event tag, defined through the profiler tool, to a specific event ID. The event ID will correspond to the ID given to it in the comment mapping section.</p>
<p>12</p>
<p>A footer indicating the end of the event tag maps</p>
<p>13</p>
<p>A header indicating the start of the event tag color maps</p>
<p>14</p>
<p>A title line showing what values are in the event tag color map columns</p>
<p>15*</p>
<p>Zero or more tab-separated lines mapping a tag label defined above to an R,G,B color</p>
<p>16</p>
<p>A header indicating the end of the event tag color maps</p>
<p>EOF</p>
<p>Sample version 2 file on 4 CPUs containing a single event of type ETName, description ETDescription, in category ETCategory with description Category description, using color 7, of duration 100 ticks, starting at tick 999, on a single thread with ID 22, tagged with TagMe which has color red (255 0 0)</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>#File Version, # of events, # of CPUs
2   1   4
ETCategory
Category description
#Comment mapping---------
@0 = ETName
#End comment mapping---------
999 @0  @0  1   100 100 22  1   7
#Begin comment description mapping---------
@1 = ETDescription
#End comment description mapping---------
#Begin Event Tag Mapping---------
#Event ID, Event Tag
1   TagMe
#End Event Tag Mapping---------
#Begin Event Tag Color Mapping---------
#Tag Label, Tag Color
TagMe   255 0 0
#End Event Tag Color Mapping---------
</code></pre></div>

<h4 id="debugging-commands">Debugging Commands</h4>
<p>Several commands can be used to help display information about your scene to help in debugging or optimizations. This is a summary of some of the more common ones, and represents only the available runtime information. Consult the command documentation in <a href="http://help.autodesk.com/cloudhelp/2020/ENU/Maya-Tech-Docs/CommandsPython/index.html">Mayas online technical documentation</a> for more information about each command.</p>
<h3 id="dbcount">dbcount</h3>
<p>Maintains embedded code location counters for higher-level debugging of scene operation. Generally, this uses specialized code that is only available in custom builds.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dbcount [flags]
Flags:
   -e -enabled      on|off
   -f -file         String
   -k -keyword      String
   -l -list        
  -md -maxdepth     UnsignedInt
   -q -quick       
   -r -reset       
   -s -spreadsheet

Command Type: Command
</code></pre></div>

<h3 id="dbmessage">dbmessage</h3>
<p>Monitors messaging that adds and removes DAG and DG nodes.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dbmessage [flags]
Flags:
   -f -file     String
   -l -list    
   -m -monitor  on|off
   -t -type     String

Command Type: Command
</code></pre></div>

<h3 id="dbtrace">dbtrace</h3>
<p>Turns on conditional code, typically to print out status information or to take different code paths when enabled.</p>
<p>To find available trace objects use <em>dbtrace q</em> to list currently-enabled traces, and <em>dbtrace q off</em> to list currently-disabled traces.</p>
<p>To find the current trace output target, use <em>dbtrace -q -k keyword -o</em>.</p>
<p>See below for information on specific keywords.</p>
<p>Note: Work is currently in progress to make these trace objects more flexible. It is a current design constraint that sometimes they are visible in a release, even though they only function internally, and some cannot be used when using Parallel evaluation.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dbtrace [flags]
Flags:
   -q -query
   -f -filter   String
   -i info
   -k -keyword  String (multi-use)
              (Query Arg Optional)
   -m -mark    
   -o -output   String
 -off -        
   -t -title    String
  -tm -timed    on|off
   -v -verbose

Command Type: Command
</code></pre></div>

<p><strong>Keyword</strong></p>
<p><strong>Description</strong></p>
<p><strong>Contents (<em>Default Output File</em>)</strong></p>
<p><em>OGSPolyGhosts</em></p>
<p>Shows progress of data extraction from the evaluation of poly ghosts through OGS</p>
<p>(<em>stdout</em>)</p>
<p><em>cacheConfig</em></p>
<p>Shows cache configuration rules evaluation</p>
<p>Result of cache configuration rules for each evaluation node (<em>_Trace_CacheConfig.txt</em>)</p>
<p><em>cipEM</em></p>
<p>Shows what Customer Improvement Program data is being collected.</p>
<p>Generic usage information. No longer being used (<em>stdout</em>)</p>
<p><em>cmdTracking</em></p>
<p>Enables the tracking of counts of commands. Use the dbpeek cmdTracking operation to view the results.</p>
<p>No output, but enables tracking of the counts for all commands being executed. (For example, you can turn it on during file load to get a count of the number of createNode calls, including those in referenced files, a task that is difficult to do manually) (<em>stdout</em>)</p>
<p><em>compute</em></p>
<p>High level trace of the compute path</p>
<p>Nested output showing compute methods being called. Typically in EM mode you should see nesting only in cycles. DG mode will show the full set of nodes triggered by a single evaluation request (<em>_Trace_Compute.txt</em>)</p>
<p><em>dbCache</em></p>
<p>Data block manipulation</p>
<p>Details of the creation and manipulation of datablock information (<em>_Trace_DataBlockCache.txt</em>)</p>
<p><em>deformerEvaluator</em></p>
<p>Statistics for the deformer evaluator setup</p>
<p>Shows statistics on what the deformer evaluator was able to ingest, once enabled (<em>stderr</em>)</p>
<p><em>evalMgr</em></p>
<p>Evaluation manager interactions</p>
<p>(<em>_Trace_EvalManager.txt</em>)</p>
<p><em>evalMgrGraphInvalid</em></p>
<p>Evaluation manager graph invalidation</p>
<p>(<em>stdout</em>)</p>
<p><em>evalMgrGraphValid</em></p>
<p>Evaluation manager execution graph validation errors and warnings</p>
<p>Nodes that were evaluated while in EMS mode using the pull (DG) model. This indicates missing dependencies in the evaluation graph, possibly caused by custom dirty propagation (<em>_MayaEvaluationGraphValidation.txt</em>)</p>
<p><em>evalMgrSched</em></p>
<p>Internal use only</p>
<p>(<em>_MayaScheduling.txt</em>)</p>
<p><em>idleBuild</em></p>
<p>Operation of the idle build mechanism for the evaluation graph</p>
<p>When the idle build is active, this appears when the idle build is triggered and executed (<em>_Trace_EGBuild.txt</em>)</p>
<p><em>nodeTracking</em></p>
<p>Enables tracking of counts of created nodes. Use the dbpeek nodeTracking operation to view results.</p>
<p>(<em>stdout</em>)</p>
<p><em>peekCache</em></p>
<p>Shows progress of the <em>dbpeek -op cache</em> operation</p>
<p>Dumps data collected by the dbpeek operation, and how (<em>_Trace_DbPeekCache.txt</em>)</p>
<p><em>peekContext</em></p>
<p>Shows progress of the <em>dbpeek -op context</em> operation</p>
<p>Dumps data collected by the dbpeek operation, and how (<em>stdout</em>)</p>
<p><em>peekData</em></p>
<p>Shows progress of the <em>dbpeek -op data</em> operation</p>
<p>Dumps data collected by the dbpeek operation, and how (<em>_Trace_DbPeekData.txt</em>)</p>
<p><em>peekMesh</em></p>
<p>Shows progress of the <em>dbpeek -op mesh</em> operation</p>
<p>Dumps data collected by the dbpeek operation, and with what flags (<em>_Trace_DbPeekMesh.txt</em>)</p>
<h3 id="dgdebug">dgdebug</h3>
<p>Historical debugging command; not robust or documented. <em><strong>Deprecated</strong>: Use the newer dbpeek command.</em></p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>No help is provided for this command.
</code></pre></div>

<h3 id="dgdirty">dgdirty</h3>
<p>Forces dirty/clean states onto specified plugs and everything downstream from them. Meant to be a safety net for restoring proper states to your scene when something has gone wrong.</p>
<p>You should not need to use this command, but it will continue to exist as a reset button, just in case.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dgdirty [flags] [String...]
Flags:
   -q -query
   -a -allPlugs    
   -c -clean       
   -i -implicit    
   -l -list         String
   -p -propagation
  -st -showTiming  
   -v -verbose

Command Type: Command
</code></pre></div>

<h3 id="dgeval">dgeval</h3>
<p>Forces the node to compute certain plugs. Like dgdirty, this command is meant to be a safety net if computation has not occurred in the proper order. Similar in function to the getAttr command, but since it returns no results, it can handle all attribute types, not only those supported by getAttr.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dgeval [flags] String...
Flags:
 -src -        
   -v -verbose

Command Type: Command
</code></pre></div>

<h3 id="dginfo">dgInfo</h3>
<p>Dumps information about the current state of the graph. Be aware that when plug dirty states are reported, they represent the connection associated with the plug. In fan-out or in-out connections there will be more than one dirty state associated with the connection attached to the plug. This means it is legal to see A-&gt;B as dirty but B-&gt;A as clean if A has multiple connections. <em><strong>Being Deprecated</strong>: Use the newer dbpeek command.</em></p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dgInfo [flags] [String...]
Flags:
 -all -allNodes     
   -c -connections  
   -d -dirty         on|off
   -n -nodes        
  -nd -nonDeletable
  -nt -type          String
  -of -outputFile    String
   -p -propagation   on|off
   -s -short        
 -sub -subgraph     
  -sz -size

Command Type: Command
</code></pre></div>

<h3 id="dgmodified">dgmodified</h3>
<p>Checks on the reason a file requests saving when no changes have been made.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dgmodified

No Flags.
</code></pre></div>

<h3 id="dbpeek">dbpeek</h3>
<p>This command is called out intentionally, as it combines multiple operations into a single command by use of various operations.</p>
<p>It runs one of several operations that provide a view into the data internals in the scene. This is the most useful and flexible of the debugging commands, and new variations of it are often being introduced. Use <em>dbpeek -q -op</em> to show a list of currently available operations and <em>dbpeek -op X -q</em> to show detailed help for operation <em>X</em>.</p>
<p>See below for information on specific keywords.</p>
<p>Note: The syntax of the argument flag allows for both keyword <em>argument=key</em> and keyword/value <em>argument=key=value</em> forms.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Synopsis: dbpeek [flags] [String...]
Flags:
   -q -query
   -a -argument         String (multi-use) (Query Arg Mandatory)
 -all -allObjects      
   -c -count            UnsignedInt
  -eg -evaluationGraph
  -of -outputFile       String
  -op -operation        String (Query Arg Optional)

Command Type: Command
</code></pre></div>

<h3 id="dbpeek-op-attributes"><em>dbpeek -op attributes</em></h3>
<p>Analyzes node or node-type attributes and dumps information about them based on what the selected operation type.</p>
<p>Various arguments to the operation change the content of the output. The essence remains the same; the attributes belong to the node or node type.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>detail</p>
<p>Adds all internal details from attributes being dumped, otherwise dumps only the names and structure. The details are output as object members of the attribute, including the children.</p>
<p>nodeType</p>
<p>Dumps all attributes belonging to the selected node(s) types. If nothing is selected, it dumps the attributes for all available node types. This includes all node types up the hierarchy to the base node class.</p>
<p>noDynamic</p>
<p>Skips dynamic attributes in all output.</p>
<p>noExtension</p>
<p>Skips extension attributes in all output.</p>
<p>noStatic</p>
<p>Skips static attributes in all output.</p>
<p>onlyPlugins</p>
<p>Restricts any output to nodes and node types that originate from a plug-in.</p>
<p>type=affects</p>
<p>Dumps attribute structure and affects relationships in the graphical <em>.dot</em> format.</p>
<p>type=detail</p>
<p>Dumps attribute information in <em>.json</em> format. This is the default if no type is specified.</p>
<p>type=validate</p>
<p>Validates flags and structure for consistency and validity.</p>
<p>If no nodes are selected, then this command prints the list of all attributes on all nodes. For example, if you had a node type called reversePoint with a vector input and a vector output.</p>
<p><em>type=detail</em> would output this JSON data:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>{
    &quot;nodes&quot; :
    {
      &quot;reversePoint&quot; :
      {
        &quot;staticAttributes&quot; : [
          { &quot;pointInput&quot; : [
              &quot;pointInputX&quot;,
              &quot;pointInputY&quot;,
              &quot;pointInputZ&quot;,
            ]
          },
          { &quot;pointOutput&quot; :
            [
15&quot;&gt;              &quot;pointOutputX&quot;,
              &quot;pointOutputY&quot;,
              &quot;pointOutputZ&quot;,
            ]
          }
        ],
        &quot;extensionAttributes&quot; : []
      }
    }
  }
</code></pre></div>

<p><em>type=affects</em> would output this DOT data:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>digraph G
{
    compound=true;
    subgraph cluster_NODENAME
    {
        label=&quot;Node NODENAME, Type NODETYPE&quot;;
        color=&quot;.7 .0 .0&quot;;
        ia [label=&quot;ia/inputAttribute&quot;,style=&quot;rounded&quot;,shape=ellipse];
        oa [label=&quot;oa/outputAttribute&quot;,style=&quot;rounded&quot;,shape=rectangle];
        ia -&gt; oa;
    }
}
</code></pre></div>

<p>and <em>type=validate</em> would output this JSON validation summary:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>{
  &quot;Attribute Validation&quot; :
  {
    &quot;NODENAME&quot; :
    {
      &quot;staticAttributes&quot; :
      [
        {
          &quot;Both input and output attributes in compound&quot; :
          [
            { &quot;root&quot; : &quot;rootAttribute&quot;,
              &quot;inputs&quot; : [&quot;inputChild&quot;],
              &quot;outputs&quot; : [&quot;outputChild&quot;],
            }
          ]
        }
      ]
    }
  }
}
</code></pre></div>

<h3 id="dbpeek-op-cache"><em>dbpeek -op cache</em></h3>
<p>This operation is explained in detail in the <a href="http://download.autodesk.com/us/company/files/2020/MayaCachedPlaybackWhitePaper.html#debugging"><strong>Debugging</strong> section</a> of the <strong>Maya Cached Playback</strong> whitepaper.</p>
<h3 id="dbpeek-op-cmdtracking"><em>dbpeek -op cmdTracking</em></h3>
<p>By default, when no detail argument is present it shows a list of all commands run since the last reset as well as a count of how many of each type were executed.</p>
<p>Outputs in command/count pair form, one per line, with a tab character separating them.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>reset</p>
<p>Set all of the command tracking statistics to zero</p>
<h3 id="dbpeek-op-connections"><em>dbpeek -op connections</em></h3>
<p>By default, when no type argument is present, shows a list of all connections in the DG.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>summary</p>
<p>Reduces the output to show only the connection counts on the nodes. It separates by single and multi but no further information is added. Useful for getting basic usage information.</p>
<p>verbose</p>
<p>Shows extra information about every connection, including dirty/propagation states, plug ownership, and type connectivity of the connection. Connections can be single or multi, and be connected either to each other or to plugs.</p>
<h3 id="dbpeek-op-data"><em>dbpeek -op data</em></h3>
<p>Dumps the current contents of a nodes plug data in a standard format. By default the output is in CSV format consisting of 5 columns: <code>NODE PLUG DATA_TYPE CLEAN_STATE DATA_AS_TEXT</code></p>
<p>Example for a simple integer attribute with a dirty value of 5: <code>MyNode MyPlug Int32 0 5</code></p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>eval</p>
<p>Evaluates plugs first to guarantee that they are clean. Note: Some plugs are always dirty so there may still be plugs that show a dirty value.</p>
<p>full</p>
<p>Includes plugs with default values in the output.</p>
<p>json</p>
<p>Uses JSON format for the output. The general form is <code>{ "NODE" : { "PLUG" : { "TYPE", "CLEAN", "VALUE" } } }</code>. For example, a simple numeric attribute with a dirty value of 5 <code>{ "MyNode" : { "MyPlug", "0", "5" } }</code></p>
<p>matrix</p>
<p>Includes all plugs with a matrix data type in the output. This does not include generic data that may have a matrix value at runtime, only attributes that are exclusively matrix types.</p>
<p>number</p>
<p>Includes all plugs with any numerical data type in the output. This does not include any generic data that may have numerical value at runtime, only attributes that are exclusively numeric types. It includes all types of numeric values, including linear, angular, time, and unitless values.</p>
<p>state</p>
<p>Includes the current dirty state of the data in the output.</p>
<p>time=TIME</p>
<p>Rather than evaluating at the normal context, evaluates at a context using the given time. This is somewhat equivalent to <em>getAttr -t TIME</em>.</p>
<p>vector</p>
<p>Includes all plugs with a vector data type in the output. Does not include generic data that may have a vector value at runtime, only attributes that are exclusively double[3] types.</p>
<h3 id="dbpeek-op-context"><em>dbpeek -op context</em></h3>
<p>Analyzes context evaluation to detect various errors violating the design.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>isolationType=animatedAttributes</p>
<p>Filters errors, reporting only those involving animated attributes</p>
<p>isolationType=animatedNodes</p>
<p>Filters errors, reporting only those involving animated nodes</p>
<p>isolationType=staticAndAnimated</p>
<p>Reports all errors</p>
<p>test=isolation</p>
<p>During evaluation, detects when evaluation context is violated causing data to be read or written into a state that belongs to some other evaluation context</p>
<p>test=correctness</p>
<p>Evaluates the scene in the background, comparing evaluation data stored for background and main context; compares traversing evaluation graph visiting nodes only if all upstream nodes generate equivalent data in both the background and the main context</p>
<p>time=TIME</p>
<p>Takes a string value indicating the frame time at which evaluation should be performed.</p>
<p>verbose</p>
<p>Adds extra information to output report. Each test will have its own verbose data. <em>Isolation</em>: Adds callstack information to the report for each detected error. <em>Correctness</em>: Adds attributes which compare failed to compare (due to missing logic)</p>
<p>Sample output for isolation tests:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>{
    &quot;context isolation&quot;: {
        &quot;frame&quot;: 5.0,
        &quot;type&quot;: &quot;animatedNodes&quot;,
        &quot;verbose&quot;: true,
        &quot;errors&quot;: [
            {
                &quot;node&quot;: &quot;ikHandle1&quot;,
                &quot;type&quot;: &quot;ikHandle&quot;,
                &quot;attribute&quot;: &quot;ikFkManipulation&quot;,
                &quot;call stack&quot;: [
                    &quot;METHOD Line NUMBER&quot;,
                    &quot;METHOD Line NUMBER&quot;,
                    &quot;METHOD Line NUMBER&quot;
                ]
            },
            {
                &quot;node&quot;: &quot;shape&quot;,
                &quot;type&quot;: &quot;mesh&quot;,
                &quot;attribute&quot;: &quot;displaySmoothMesh&quot;,
                &quot;call stack&quot;: [
                    &quot;METHOD Line NUMBER&quot;,
                    &quot;METHOD Line NUMBER&quot;,
                    &quot;METHOD Line NUMBER&quot;
                ]
            }
        ],
        &quot;time out&quot;: true
    }
}
</code></pre></div>

<p>Sample output for correctness tests:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>{
    &quot;context correctness&quot;: {
        &quot;frame&quot;: 14.0,
        &quot;verbose&quot;: true,
        &quot;errors&quot;: [
            {
                &quot;node&quot;: &quot;IKSpineCurveShape&quot;,
                &quot;type&quot;: &quot;nurbsCurve&quot;,
                &quot;attributes&quot;: [
                    &quot;worldSpace&quot;
                ]
            }
        ],
        &quot;failed to compare&quot;: [
            &quot;input&quot;,
            &quot;clusterXforms&quot;,
            &quot;clusterTransforms&quot;,
            &quot;target&quot;,
            &quot;mySpecialAttribute&quot;
        ],
        &quot;time out&quot;: true
    }
}
</code></pre></div>

<h3 id="dbpeek-op-edits"><em>dbpeek -op edits</em></h3>
<p>Shows a list of all nodes for which tracking is currently enabled. The track flag is mandatory.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>track</p>
<p>Shows a list of all nodes for which tracking is currently enabled.</p>
<h3 id="dbpeek-op-evalmgr"><em>dbpeek -op evalMgr</em></h3>
<p>Outputs the current state of all of the custom evaluators used by the Evaluation Manager.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>custom</p>
<p>Outputs the custom evaluators registered with the evaluation manager.</p>
<p>global</p>
<p>Adds output that is independent of scene contents, for example, node types enabled for the custom evaluators.</p>
<p>local</p>
<p>Adds output that is specific to the scene contents, for example, nodes supported by a custom evaluator.</p>
<h3 id="dbpeek-op-graph"><em>dbpeek -op graph</em></h3>
<p>Gets a list of nodes or connections from either the dependency graph or the underlying evaluation graph.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>connections</p>
<p>Dumps the list of all connections in the chosen graph. The sorting order is alphabetical by destination plug name.</p>
<p>dot</p>
<p>Dumps the graph information in .dot format for parsing and display by an external application such as graphViz.</p>
<p>evaluationGraph</p>
<p>Gets the structure information from the evaluation graph, otherwise uses the raw dependency graph. The dbpeek command flag evaluationGraph does the same thing.</p>
<p>graph</p>
<p>Dumps the graph state and contents, not including what is dumped by any of the other flags.</p>
<p>nodes</p>
<p>Dumps the list of all nodes in the chosen type of graph, in alphabetical order by full node name.</p>
<p>plugs</p>
<p>For the evaluation graph option, dumps the list of all plugs in its dirty plug list in the evaluation nodes. For the DG option, dumps the list of plugs currently in the plug trees.</p>
<p>scheduling</p>
<p>Dumps the scheduling type used for all nodes in the type of graph in the form NODE = SCHEDULING_TYPE. If a node type is specified, the default scheduling type for nodes of that specific node type is returned in the same format.</p>
<p>verbose</p>
<p>When dumping the scheduling graph in .dot format, adds all of the names of the nodes to the clusters. Otherwise, it is only a count of nodes in each cluster</p>
<h3 id="dbpeek-op-mesh"><em>dbpeek -op mesh</em></h3>
<p>Dumps the current contents of the mesh to a standard format. There are two types of formatting and two levels of detail to present.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>eval</p>
<p>Evaluates mesh plugs first to guarantee they are clean. Otherwise the values currently present in the mesh shape are used as-is.</p>
<p>json</p>
<p>Dumps data in JSON format instead of CSV.</p>
<p>verbose</p>
<p>Puts full values for all of the data in the output. Otherwise, only a number count of each type is returned. See the flag descriptions for more information on which data can be requested and what is returned for each type.</p>
<p>vertex</p>
<p>Includes vertex position or vertex count in the output. The short return is a count of vertices in the mesh. The verbose values are a list of vertex number and the {X,Y,Z} positions of the vertex, with W factored in, if appropriate.</p>
<p>For the default level of detail, the default CSV format output will look like this:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>NODE_NAME,DATA_TYPE,DATA_COUNT
</code></pre></div>

<p>For example, a cube containing 32 vertices would have these lines:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Node,DataType,Count
pCubeShape1,outMesh,32
</code></pre></div>

<p>The JSON equivalent format would look like this:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>{
    &quot;pCubeShape1&quot; : {
        &quot;outMesh&quot; : &quot;32&quot;
    }
}
</code></pre></div>

<p>If the full detail is requested, then the (abbreviated) output for CSV format will look like this:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Node,Plug,Clean,Value
pCubeShape1,outMesh[0],1,0.0 0.0 0.0
pCubeShape1,outMesh[1],1,0.0 0.5 0.0
...
pCubeShape1,outMesh[32],1,1.0 1.0 1.0
</code></pre></div>

<p>and like this for JSON format:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>{
    &quot;pCubeShape1&quot; : {
        &quot;outMesh&quot; : {
            &quot;clean&quot; : 1,
            &quot;0&quot; : [0.0, 0.0, 0.0],
            &quot;1&quot; : [0.0, 0.5, 0.0],
            &quot;...&quot; : &quot;...&quot;,
            &quot;32&quot;: [1.0, 1.0, 1.0]
        }
    }
}
</code></pre></div>

<h3 id="dbpeek-op-metadata"><em>dbpeek -op metadata</em></h3>
<p>Shows node metadata. The default operation shows a list of all nodes containing metadata.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>summary</p>
<p>Shows a single line per node, with metadata indicating how many channels, streams, and values are present in the metadata.</p>
<p>verbose</p>
<p>Shows a detailed list of all metadata on nodes, including a dump in the debug serialization format for each of the metadata streams.</p>
<h3 id="dbpeek-op-node"><em>dbpeek -op node</em></h3>
<p>Show select debugging information on DG nodes. See also the plug and connection operations for display of information specific to those facets of a node. If no arguments are used then the ones marked as <em>[default]</em> will all be enabled, for convenience.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>datablock</p>
<p><em>[default]</em> Shows the values in the datablock(s)</p>
<p>datablockMemory</p>
<p>Shows raw datablock memory. This is independent of the other other datablock flags.</p>
<p>dynamicAttr</p>
<p>Shows dynamic attributes.</p>
<p>evaluationGraph</p>
<p><em>[default]</em> Includes evaluation graph information on the node</p>
<p>extensionAttr</p>
<p>Shows the extension attributes</p>
<p>node</p>
<p><em>[default]</em> Shows information specific to individual node types, such internal caches, flags, or special relationships it maintains. All other data shown is common to all node types</p>
<p>plug</p>
<p><em>[default]</em> Shows the nodes plug information</p>
<p>skipClean</p>
<p>Does not include datablock values that are clean</p>
<p>skipDirty</p>
<p><em>[default]</em> Does not include the datablock values that are dirty</p>
<p>skipMulti</p>
<p>Does not include the datablock values that are multi (array) attributes</p>
<p>staticAttr</p>
<p>Shows the static attributes</p>
<p>verbose</p>
<p>Shows much more detail where available. This will include things such as flags set on objects, full detail on heavy data, and any extra detail specific to a node type, such as caches.</p>
<h3 id="dbpeek-op-nodes"><em>dbpeek -op nodes</em></h3>
<p>By default, when no detail argument is present, shows a list of all currently registered node types.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>binary</p>
<p>Also includes the IFF tag used to identify each node type in the .mb file format</p>
<h3 id="dbpeek-op-nodetracking"><em>dbpeek -op nodeTracking</em></h3>
<p>By default, when no argument is present, shows a list of all nodes created since the last reset along with a count of how many of each type were created. Output is in the form of nodeType/count pairs, one per line, with a tab character separating them.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>reset</p>
<p>Erases all of the node tracking statistics.</p>
<h3 id="dbpeek-op-plugs"><em>dbpeek -op plugs</em></h3>
<p>Shows information about all of the plugs in a scene. By default, when no argument is present, shows static plug footprint. A lot of this is only displayed in specially-instrumented builds, and generally only of use internally.</p>
<p><strong>Argument</strong></p>
<p><strong>Meaning</strong></p>
<p>details</p>
<p>Includes the full plug/node name information in the output. Otherwise only the total and summary counts are dumped.</p>
<p>group=stat</p>
<p>Groups all output by statistic name</p>
<p>group=node</p>
<p>Groups all output by node name</p>
<p>mode=footprint</p>
<p>Reports size information for currently-existing networked plugs.</p>
<p>mode=usage</p>
<p>Reports dynamic code path statistics, if they have been enabled in the current build</p>
<p>mode=reset</p>
<p>When used in conjunction with usage, resets the statistics back to zero.</p>
<p>mode=state</p>
<p>Gets unevaluated state information for boolean plugs. <em>Only available on specially-built cuts.</em></p>
<p>nodeType=TYPE</p>
<p>Restricts the operation to the node types specified in the argument. This includes inherited types, for example if the value is transform, then the operation also applies to joint nodes, as the node type joint inherits from the node type transform. See the node type documentation or the nodeType command for complete information on which node types inherit from each other.</p>
<p>stat=STAT</p>
<p>If this argument has no STAT, then sorts by the name of the statistic. If this argument does have a STAT, for example, stat=addToNet, then only reports that statistic. <em>Only available on specially-built cuts.</em></p>
<h3 id="revisions">Revisions</h3>
<h4 id="2020">2020</h4>
<ul>
<li>Updated the <a href="#dbtrace">dbtrace</a> section to add info about:<ul>
<li><em>OGSPolyGhosts</em></li>
<li><em>cacheConfig</em></li>
<li><em>evalMgr</em></li>
<li><em>evalMgrGraphInvalid</em></li>
<li><em>peekCache</em></li>
<li><em>peekContext</em></li>
</ul>
</li>
<li>Added a link in the <a href="#dbpeek">dbpeek</a> section to details regarding the new <em>cache</em> operation.</li>
</ul>
<h4 id="2019">2019</h4>
<ul>
<li>Updated the <a href="#key-concepts">Key Concepts</a> section.<ul>
<li>Added more info about the different graphs (DG, EG, SG).</li>
</ul>
</li>
<li>Added a section about <a href="#vp2-integration">VP2 Integration</a> and Evaluation Manager Parallel Update.</li>
<li>Added a section about <a href="#tracking-topology">Tracking Topology</a> for Evaluation Manager Parallel Update.</li>
<li>Updated the <a href="#custom-evaluators">Custom Evaluators</a> section to describe the new evaluators.<ul>
<li>New evaluators:<ul>
<li><a href="#curve-manager-evaluator">curveManager</a> (now with its own subsection)</li>
<li><a href="#other-evaluators">cache</a></li>
<li><a href="#other-evaluators">cycle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2018">2018</h4>
<ul>
<li>Created an <a href="#appendices">Appendices</a> section.<ul>
<li>Added a section that describes the <a href="#profiler-file-format">Profiler File Format</a>.</li>
<li>Moved <a href="#debugging-commands">Debugging Commands</a> section to the <a href="#appendices">Appendices</a>.</li>
</ul>
</li>
<li>Updated the <a href="#custom-evaluators">Custom Evaluators</a> section to describe the new evaluators.<ul>
<li>New evaluators:<ul>
<li><a href="#other-evaluators">curveManager</a></li>
<li><a href="#other-evaluators">hik</a></li>
</ul>
</li>
<li>Added information on isolate-select and expressions to the <a href="#invisibility-evaluator">Invisibility Evaluator</a></li>
<li>Added new deformer types supported in <a href="#gpu-override">GPU override</a>:<ul>
<li>deltaMush</li>
<li>lattice</li>
<li>nonLinear</li>
<li>tension</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2017">2017</h4>
<ul>
<li>Added section on <a href="#evaluation-graph-invalidation">graph invalidation</a>.</li>
<li>Added information about different ways to query scheduling information (see <a href="#thread-safety">Thread Safety</a>).</li>
<li>Updated the <a href="#custom-evaluators">Custom Evaluators</a> section to describe the new evaluators.<ul>
<li>New evaluators:<ul>
<li><a href="#invisibility-evaluator">invisibility</a></li>
<li><a href="#frozen-evaluator">frozen</a></li>
<li><a href="#other-evaluators">timeEditorCurveEvaluator</a></li>
</ul>
</li>
<li>dynamics evaluator support for Parallel evaluation of scenes with dynamics is now enabled by default.</li>
</ul>
</li>
<li>Added <a href="#custom-evaluator-api">Custom Evaluator API</a> section.</li>
<li>Added <a href="#the-evaluation-toolkit">Evaluation Toolkit</a> section.</li>
<li>Added <a href="#debugging-commands">Debugging Commands</a> section.</li>
<li>Miscellaneous typo fixes and small corrections.</li>
</ul>
<h4 id="2016-extension-2">2016 Extension 2</h4>
<ul>
<li>Added tip about the <a href="http://help.autodesk.com/cloudhelp/2016/ENU/Maya-Tech-Docs/Commands/controller.html">controller</a> command.</li>
<li>Updated <a href="#other-evaluators">Other Evaluators</a> subsection in the <a href="#custom-evaluators">Custom Evaluators</a> section to describe the new evaluators.<ul>
<li>New evaluators:<ul>
<li>transformFlattening</li>
<li>reference</li>
</ul>
</li>
<li>deformer evaluator is now enabled by default.</li>
<li>dynamics evaluator has a new behavior, disabled by default, to support Parallel evaluation of scenes with dynamics.</li>
</ul>
</li>
<li>Updated <a href="#evaluator-conflicts">Evaluator Conflicts</a> subsection in the <a href="#custom-evaluators">Custom Evaluators</a> section.</li>
<li>Updated Python plug-ins scheduling to Globally Serial.</li>
<li>Updated <a href="#render-bound-performance">Render-Bound Performance</a> subsection in the <a href="#profiling-your-scene">Profiling Your Scene</a> section.</li>
<li>Added new images for graph examples.</li>
<li>Miscellaneous typo fixes and small corrections.</li>
</ul>
<h4 id="2016">2016</h4>
<ul>
<li>Initial version of the document.</li>
</ul>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: 2022-04-04
    
  </small>
</div>
                  
                
              

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020-2022 mottosso
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../extra.js"></script>
      
    
  </body>
</html>